<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-adsense-account" content="ca-pub-3945001668113003">
    <title>AnnotateShot: Effortless Screenshot Markup</title>
    <meta name="description" content="AnnotateShot - 스크린샷에 쉽게 숫자와 도형을 추가하세요. 간편하고 효과적인 이미지 주석 도구.">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <!-- Usage Monitoring -->
    <script src="usage-monitor.js"></script>
    
    <!-- Device Detection & Dynamic CSS Loading -->
    <script src="src/device-detector.js"></script>
    
    <!-- External CSS Files -->
    <link rel="stylesheet" href="src/styles/common.css" id="common-css">
    <link rel="stylesheet" href="src/styles/desktop.css" id="desktop-css">
    <link rel="stylesheet" href="src/styles/mobile.css" id="mobile-css" disabled>
    
    <style>
        :root {
            /* Light theme colors */
            --background: #ffffff;
            --foreground: #0f172a;
            --card: #ffffff;
            --card-foreground: #0f172a;
            --primary: #3b82f6;
            --primary-foreground: #ffffff;
            --secondary: #f1f5f9;
            --secondary-foreground: #0f172a;
            --muted: #f1f5f9;
            --muted-foreground: #64748b;
            --accent: #f1f5f9;
            --accent-foreground: #0f172a;
            --border: #e2e8f0;
            --input: #e2e8f0;
            --ring: #3b82f6;
            --radius: 0.5rem;
            --success-color: #22c55e;
            --destructive: #ef4444;
            --destructive-foreground: #ffffff;
            
            /* Sidebar specific */
            --sidebar-background: var(--card);
            --sidebar-foreground: var(--card-foreground);
            --sidebar-border: var(--border);
        }

        .dark {
            /* Dark theme colors */
            --background: #0f172a;
            --foreground: #f8fafc;
            --card: #1e293b;
            --card-foreground: #f8fafc;
            --primary: #3b82f6;
            --primary-foreground: #ffffff;
            --secondary: #334155;
            --secondary-foreground: #f8fafc;
            --muted: #334155;
            --muted-foreground: #94a3b8;
            --accent: #334155;
            --accent-foreground: #f8fafc;
            --border: #334155;
            --input: #334155;
            --ring: #3b82f6;
            --success-color: #22c55e;
            --destructive: #ef4444;
            --destructive-foreground: #ffffff;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', system-ui, sans-serif;
            background-color: var(--background);
            color: var(--foreground);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
        }

        .app-container {
            display: flex;
            height: 100vh;
            background-color: var(--background);
        }

        /* Sidebar Styles */
        .sidebar {
            background-color: var(--card);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            z-index: 20;
            width: 280px;
        }

        .sidebar-header {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            height: 74px;
            display: flex;
            align-items: center;
        }

        .sidebar-header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo-icon {
            color: var(--primary);
            font-size: 1.5rem;
        }

        .logo-text {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--foreground);
        }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        .tool-panel {
            margin-bottom: 1.5rem;
        }

        .panel-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--foreground);
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }


        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
            cursor: pointer;
            border: 1px solid var(--border);
            background-color: var(--background);
            color: var(--foreground);
            text-decoration: none;
            min-height: 2.5rem;
        }

        .btn:hover {
            background-color: var(--muted);
        }

        .btn.primary {
            background-color: var(--primary);
            color: var(--primary-foreground);
            border-color: var(--primary);
        }

        .btn.primary:hover {
            background-color: var(--primary);
            opacity: 0.9;
        }

        .btn.btn-icon {
            padding: 0.5rem;
            width: 2.5rem;
            height: 2.5rem;
            justify-content: center;
        }

        .btn.btn-icon .material-icons {
            margin: 0;
        }

        .btn.success {
            background-color: var(--success-color);
            color: white;
            border-color: var(--success-color);
        }

        .btn.success:hover {
            background-color: var(--success-color);
            opacity: 0.9;
        }

        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .btn-row {
            display: flex;
            gap: 0.5rem;
        }


        select {
            width: 100%;
            padding: 0.5rem;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            background-color: var(--background);
            color: var(--foreground);
            font-size: 0.875rem;
            min-height: 2.5rem;
        }

        select:focus {
            outline: none;
            border-color: var(--ring);
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
        }

        input[type="file"] {
            width: 100%;
            padding: 0.5rem;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            background-color: var(--background);
            color: var(--foreground);
            font-size: 0.875rem;
            cursor: pointer;
        }


        .style-section {
            margin-bottom: 1rem;
        }

        .style-subtitle {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--muted-foreground);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .footer-links {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .footer-link {
            justify-content: flex-start;
            gap: 0.75rem;
            font-size: 0.825rem;
            color: var(--muted-foreground);
            text-decoration: none;
            background-color: transparent;
            border: none;
            padding: 0.75rem;
        }

        .footer-link:hover {
            background-color: var(--muted);
            color: var(--foreground);
        }

        .footer-link .material-icons {
            font-size: 1rem;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: var(--background);
        }

        .top-bar {
            background-color: var(--card);
            border-bottom: 1px solid var(--border);
            padding: 1rem;
            height: 74px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            pointer-events: auto;
        }

        .top-bar h2 {
            font-size: 1.125rem;
            font-weight: 500;
            color: var(--foreground);
            margin: 0;
            flex: 1;
        }

        .top-bar-actions {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            position: relative;
            z-index: 110;
            pointer-events: auto;
        }

        .chrome-extension-link:hover {
            background: linear-gradient(135deg, #3367d6, #2d8659) !important;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .chrome-extension-link:active {
            transform: translateY(0);
        }

        /* 모바일 전용 UI - User Agent 기반 */
        .mobile-device .chrome-extension-link {
            display: none !important; /* 모바일에서 완전히 숨김 */
        }
        
        .mobile-device .top-bar-actions {
            gap: 0.25rem;
        }
        
        .mobile-device .top-bar-actions label {
            font-size: 0.75rem !important;
        }
        
        /* 모바일에서 리사이즈 옵션 숨기기 */
        .mobile-device .top-resize-selector option:not([value=""]):not([value="auto"]) {
            display: none;
        }
        
        /* 모바일에서 불필요한 컨트롤들 숨기기 */
        .mobile-device .sidebar .control-group:has(.top-resize-selector) label {
            display: none;
        }
        
        /* 인스타그램 스타일 상단바 */
        .mobile-device .top-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            justify-content: center;
            padding: 1rem 3rem;
            min-height: 60px;
            background-color: rgba(0, 0, 0, 0.8); /* 반투명 검은 배경 */
            backdrop-filter: blur(10px); /* 블러 효과 */
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 95; /* 최상위 */
        }
        
        .mobile-device .top-bar::before {
            content: "AnnotateShot";
            font-size: 1.25rem;
            font-weight: 600;
            color: #FFFFFF; /* 인스타그램 스타일 흰색 텍스트 */
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
        }
        
        /* 모바일에서 상단바의 모든 컨트롤 숨기기 */
        .mobile-device .top-bar-actions {
            display: none !important;
        }
        
        .mobile-device .top-bar .chrome-extension-link,
        .mobile-device .top-bar select,
        .mobile-device .top-bar label {
            display: none !important;
        }
        
        /* 모바일에서 햄버거 메뉴 완전 숨기기 */
        .mobile-device .mobile-menu-btn-removed {
            display: none !important;
        }
        
        /* 모바일에서 PC 사이드바 비활성화 */
        .mobile-device .sidebar {
            display: none !important;
        }
        
        .mobile-device .layer-sidebar {
            display: none !important;
        }
        
        /* 데스크톱에서 모바일 전용 요소 완전 숨김 */
        .mobile-only {
            display: none !important;
        }
        
        /* 모바일에서만 모바일 전용 요소 표시 */
        .mobile-device .mobile-only {
            display: block !important;
        }
        
        /* 데스크톱에서 모바일 툴바 강제 숨김 */
        body:not(.mobile-device) .mobile-toolbar,
        body:not(.mobile-device) .floating-action-buttons,
        body:not(.mobile-device) .emoji-layer {
            display: none !important;
        }
        
        /* 모바일에서 사이드바 헤더 조정 */
        .mobile-device .sidebar-header .logo-text {
            display: block; /* 텍스트는 다시 표시 */
        }
        
        /* 모바일에서 "이미지편집" 텍스트만 숨김 - 더 강한 선택자 */
        .mobile-device .sidebar-header .logo-text .desktop-text {
            display: none !important;
        }
        
        /* 모바일에서 아이콘을 이미지로 교체 - 더 강한 선택자 */
        .mobile-device .sidebar-header .logo-icon {
            font-size: 0 !important; /* Material Icons 텍스트 숨김 */
            width: 1.5rem !important;
            height: 1.5rem !important;
            background-image: url('extension/icon.png') !important;
            background-size: contain !important;
            background-repeat: no-repeat !important;
            background-position: center !important;
            display: inline-block !important;
        }
        
        .mobile-device .sidebar-header {
            padding: 1rem;
            text-align: center;
        }

        .top-resize-selector {
            min-width: 180px;
            padding: 0.5rem;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            background-color: var(--background);
            color: var(--foreground);
            font-size: 0.875rem;
            min-height: 2.5rem;
            cursor: pointer;
            position: relative;
            z-index: 120;
            pointer-events: auto;
        }

        .top-resize-selector:focus {
            outline: none;
            border-color: var(--ring);
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
            z-index: 121;
        }

        .top-resize-selector:hover {
            background-color: var(--muted);
        }


        .canvas-area {
            flex: 1;
            padding: 1.5rem;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: var(--muted);
            background-image: 
                radial-gradient(circle, var(--border) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .canvas-container {
            position: relative;
            background: var(--card);
            border-radius: calc(var(--radius) * 2);
            padding: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            max-width: 100%;
            max-height: 100%;
            overflow: auto;
        }

        #imageCanvas {
            border-radius: var(--radius);
            display: block;
        }
        
        #imageCanvas.default-canvas {
            max-width: 100%;
            max-height: 100%;
        }

        #imageCanvas.transparent-background {
            background-image: 
                linear-gradient(45deg, #e0e0e0 25%, transparent 25%), 
                linear-gradient(-45deg, #e0e0e0 25%, transparent 25%), 
                linear-gradient(45deg, transparent 75%, #e0e0e0 75%), 
                linear-gradient(-45deg, transparent 75%, #e0e0e0 75%);
            background-size: 60px 60px;
            background-position: 0 0, 0 30px, 30px -30px, -30px 0px;
            background-color: #ffffff;
        }

        .status-bar {
            background-color: var(--card);
            border-top: 1px solid var(--border);
            padding: 0.5rem 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            color: var(--muted-foreground);
            font-family: 'Courier New', monospace;
        }

        .status-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        #statusText {
            color: var(--muted-foreground);
            background-color: var(--muted);
            padding: 0.25rem 0.5rem;
            border-radius: calc(var(--radius) / 2);
            font-size: 0.8rem;
            min-width: 200px;
            text-align: center;
        }

        /* Message */
        #message {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background-color: var(--success-color);
            color: white;
            padding: 0.75rem 1rem;
            border-radius: var(--radius);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 50;
        }

        #message.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* Material Icons */
        .material-icons {
            font-family: 'Material Icons';
            font-weight: normal;
            font-style: normal;
            font-size: 1.25rem;
            line-height: 1;
            letter-spacing: normal;
            text-transform: none;
            display: inline-block;
            white-space: nowrap;
            word-wrap: normal;
            direction: ltr;
            font-feature-settings: 'liga';
            -webkit-font-feature-settings: 'liga';
            -webkit-font-smoothing: antialiased;
        }

        /* Layer Sidebar Styles */
        .layer-sidebar {
            background-color: var(--card);
            border-left: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            box-shadow: -4px 0 6px -1px rgba(0, 0, 0, 0.1), -2px 0 4px -1px rgba(0, 0, 0, 0.06);
            z-index: 20;
            width: 280px;
            transition: width 0.3s ease;
        }

        .layer-sidebar.collapsed {
            width: 50px;
        }

        .layer-sidebar-header {
            background-color: var(--muted);
            border-bottom: 1px solid var(--border);
            padding: 1rem;
            min-height: 74px;
            display: flex;
            align-items: center;
        }

        .layer-sidebar-header-content {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            width: 100%;
        }

        .layer-sidebar-header h3 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--foreground);
            margin: 0;
            flex: 1;
        }

        .layer-sidebar-collapse {
            padding: 0.375rem;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            border-radius: 0.375rem;
            transition: all 0.2s ease;
        }

        .layer-sidebar-collapse:hover {
            background-color: var(--accent);
            color: var(--accent-foreground);
        }

        .layer-sidebar.collapsed .layer-sidebar-collapse .material-icons {
            transform: rotate(180deg);
        }

        .layer-sidebar-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .layer-sidebar.collapsed .layer-sidebar-content {
            display: none;
        }

        .layer-list {
            flex: 1;
            overflow-y: auto;
            padding: 0.5rem;
        }

        .layer-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background-color: var(--background);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .layer-item:hover {
            background-color: var(--accent);
            border-color: var(--primary);
        }

        .layer-item.selected {
            background-color: var(--primary);
            color: var(--primary-foreground);
            border-color: var(--primary);
        }

        .layer-item.background-layer {
            opacity: 0.8;
        }

        .layer-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex: 1;
        }

        .layer-icon {
            font-size: 1.25rem;
            color: var(--muted-foreground);
        }

        .layer-item.selected .layer-icon {
            color: var(--primary-foreground);
        }

        .layer-name {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--foreground);
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .layer-item.selected .layer-name {
            color: var(--primary-foreground);
        }

        .layer-controls {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .layer-visibility-toggle {
            padding: 0.25rem;
            background: transparent;
            border: none;
            color: var(--muted-foreground);
            cursor: pointer;
            border-radius: 0.25rem;
            transition: all 0.2s ease;
        }

        .layer-visibility-toggle:hover {
            background-color: var(--accent);
        }

        .layer-visibility-toggle.hidden .material-icons {
            opacity: 0.3;
        }

        .layer-item.selected .layer-visibility-toggle {
            color: var(--primary-foreground);
        }

        .layer-actions {
            padding: 1rem;
            border-top: 1px solid var(--border);
        }

        .layer-actions .btn {
            width: 100%;
            justify-content: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }

        /* 모바일 전용 레이아웃 - User Agent 기반 */
        .mobile-device .sidebar {
            position: fixed;
            left: -280px;
            height: 100vh;
            z-index: 90;
            transition: left 0.3s ease;
        }

        .mobile-device .sidebar.mobile-open {
            left: 0;
        }

        .mobile-device .sidebar.collapsed {
            left: -60px;
        }

        .mobile-device .main-content {
            width: 100%;
        }

        .mobile-device .layer-sidebar {
            position: fixed;
            right: -280px;
            height: 100vh;
            z-index: 90;
            transition: right 0.3s ease;
        }

        .mobile-device .layer-sidebar.mobile-open {
            right: 0;
        }

        .mobile-device .layer-sidebar.collapsed {
            right: -50px;
        }

        .mobile-device .mobile-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 25;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .mobile-device .mobile-overlay.show {
            opacity: 1;
            pointer-events: auto;
        }

        .mobile-device .top-bar {
            padding-left: 3rem;
        }

        .mobile-device .mobile-menu-btn-removed {
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 35;
            background-color: var(--primary);
            color: var(--primary-foreground);
            border: none;
            padding: 0.75rem;
            border-radius: var(--radius);
            cursor: pointer;
            display: block !important;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .mobile-device .mobile-menu-btn-removed:hover {
            background-color: var(--primary);
            transform: scale(1.05);
        }

        .mobile-device .mobile-menu-btn-removed:active {
            transform: scale(0.95);
        }

        /* 데스크톱에서는 모바일 요소들 숨기기 */
        .desktop-device .mobile-menu-btn-removed {
            display: none !important;
        }

        .desktop-device .mobile-overlay {
            display: none;
        }

        /* 모바일 터치 최적화 */
        .mobile-device button, 
        .mobile-device select, 
        .mobile-device input[type="range"],
        .mobile-device .button {
            min-height: 44px !important;
            min-width: 44px !important;
            font-size: 16px !important; /* iOS 줌 방지 */
            padding: 0.75rem 1rem !important;
        }

        .mobile-device .control-group button {
            padding: 0.875rem 1.25rem !important;
            font-size: 0.9rem !important;
            border-radius: 8px !important;
        }

        .mobile-device .color-option {
            width: 48px !important;
            height: 48px !important;
            border-radius: 50% !important;
            border: 3px solid var(--border) !important;
            margin: 0.25rem !important;
        }

        .mobile-device .size-display,
        .mobile-device .number-count {
            font-size: 1.1rem !important;
            padding: 0.75rem !important;
            min-height: 44px !important;
        }

        /* 모바일 전용 플로팅 버튼 - 인스타그램 스타일 */
        .mobile-device .floating-action-buttons {
            position: fixed;
            bottom: 140px; /* 하단 툴바 위쪽으로 이동 */
            right: 1rem; /* 오른쪽 여백 줄임 */
            z-index: 100; /* 높은 z-index로 항상 최상위 */
            display: flex;
            flex-direction: column;
            gap: 0.5rem; /* 간격 줄임 */
        }

        .mobile-device .fab {
            width: 48px; /* 크기 줄임 */
            height: 48px; /* 크기 줄임 */
            border-radius: 50%;
            background-color: var(--primary);
            color: var(--primary-foreground);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem; /* 아이콘 크기 조정 */
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
            cursor: pointer;
            transition: all 0.2s ease;
            backdrop-filter: blur(10px);
        }

        .mobile-device .fab:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }

        .mobile-device .fab:active {
            transform: scale(0.95);
        }

        .mobile-device .fab.save {
            background-color: var(--success-color);
        }

        .mobile-device .fab.undo {
            background-color: var(--muted);
            color: rgba(255, 255, 255, 0.7);
        }

        /* 모바일에서 캔버스 터치 동작 최적화 */
        .mobile-device .canvas-container {
            touch-action: none; /* 브라우저 기본 터치 동작 방지 */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .mobile-device #imageCanvas {
            touch-action: none;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        /* 모바일 전용 하단 툴바 */
        .mobile-device .mobile-toolbar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: rgba(0, 0, 0, 0.8); /* 반투명 검은 배경 */
            backdrop-filter: blur(10px); /* 블러 효과 */
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1rem;
            z-index: 90;
            display: flex;
            justify-content: space-around;
            align-items: center;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        }

        .mobile-device .mobile-toolbar .toolbar-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
            padding: 0.5rem;
            border: none;
            background: transparent;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.75rem;
            cursor: pointer;
            min-width: 44px;
            min-height: 44px;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .mobile-device .mobile-toolbar .toolbar-button.active {
            background-color: rgba(255, 255, 255, 0.2);
            color: #FFFFFF;
        }

        .mobile-device .mobile-toolbar .toolbar-button:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: #FFFFFF;
        }
        
        /* 이모지 선택 레이어 */
        .mobile-device .emoji-layer {
            position: fixed;
            bottom: 90px; /* 툴바 위쪽 */
            left: 1rem;
            right: 1rem;
            background: rgba(0, 0, 0, 0.95);
            border-radius: 12px;
            padding: 1rem;
            z-index: 1000;
            animation: slideUp 0.3s ease-out;
        }
        
        .mobile-device .emoji-layer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .mobile-device .emoji-layer-header h3 {
            color: #FFFFFF;
            margin: 0;
            font-size: 1.1rem;
        }
        
        .mobile-device .emoji-close-btn {
            background: none;
            border: none;
            color: #FFFFFF;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 50%;
            transition: background-color 0.2s ease;
        }
        
        .mobile-device .emoji-close-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .mobile-device .emoji-layer-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 0.75rem;
        }
        
        .mobile-device .emoji-layer-btn {
            width: 48px;
            height: 48px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .mobile-device .emoji-layer-btn:hover,
        .mobile-device .emoji-layer-btn.selected {
            border-color: #FFF;
            background-color: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* 인스타그램 스타일 메인 콘텐츠 - 스크롤 없는 전체화면 */
        .mobile-device .main-content {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            padding: 0 !important;
            margin: 0 !important;
            max-width: none !important;
            overflow: hidden !important; /* 모든 스크롤 방지 */
            background: #000 !important; /* 검은 배경 */
        }
        
        /* 인스타그램 스타일 전체화면 이미지 편집 모드 */
        .mobile-device .canvas-container {
            position: fixed !important;
            top: 50px !important; /* 상단바 아래 */
            left: 0 !important;
            width: 100vw !important;
            height: calc(100vh - 140px) !important; /* 상단바와 하단 툴바 제외 */
            padding: 0 !important;
            margin: 0 !important;
            background: #000 !important; /* 검은 배경 */
            border-radius: 0 !important; /* 모서리 둥글게 제거 */
            box-shadow: none !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            z-index: 1 !important;
            overflow: hidden !important;
        }
        
        /* 인스타그램 스타일 캔버스 - 화면에 맞게 스케일링 */
        .mobile-device #imageCanvas {
            max-width: 100vw !important;
            max-height: calc(100vh - 140px) !important;
            width: auto !important;
            height: auto !important;
            margin: 0 !important;
            border-radius: 0 !important;
            border: none !important;
            box-shadow: none !important;
            object-fit: contain !important; /* 비율 유지하며 화면에 맞춤 */
            background: transparent !important;
        }

        /* 모바일 전용 모드 선택 패널 */
        .mobile-device .mobile-mode-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--card);
            border-radius: 12px;
            padding: 1.5rem;
            z-index: 50;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 90vw;
            max-height: 80vh;
            overflow-y: auto;
            display: none;
        }

        .mobile-device .mobile-mode-panel.show {
            display: block;
        }

        .mobile-device .mode-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }

        .mobile-device .mode-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1.5rem 1rem;
            border: 2px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 100px;
            background-color: var(--background);
        }

        .mobile-device .mode-card:hover,
        .mobile-device .mode-card.active {
            border-color: var(--primary);
            background-color: var(--primary);
            color: var(--primary-foreground);
        }

        .mobile-device .mode-card .material-icons {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .mobile-device .mode-card .mode-name {
            font-size: 0.9rem;
            font-weight: 500;
            text-align: center;
        }
        
        /* 모바일 설정 패널 */
        .mobile-device .mobile-settings-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--card);
            border-radius: 12px;
            padding: 1.5rem;
            z-index: 60;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 90vw;
            max-height: 80vh;
            overflow-y: auto;
            display: none;
            min-width: 300px;
        }
        
        .mobile-device .mobile-settings-panel.show {
            display: block;
        }
        
        .mobile-device .setting-section {
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }
        
        .mobile-device .setting-section:last-of-type {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .mobile-device .mobile-color-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
        }
        
        .mobile-device .mobile-color-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: 3px solid var(--border);
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .mobile-device .mobile-color-btn:hover,
        .mobile-device .mobile-color-btn.active {
            transform: scale(1.1);
            border-color: var(--foreground);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
        
        .mobile-device .mobile-color-btn.active::after {
            content: "✓";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .mobile-device .mobile-size-slider input[type="range"] {
            appearance: none;
            height: 6px;
            background: var(--muted);
            outline: none;
            border-radius: 3px;
        }
        
        .mobile-device .mobile-size-slider input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 24px;
            height: 24px;
            background: var(--primary);
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .mobile-device .mobile-emoji-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 0.5rem;
        }
        
        .mobile-device .mobile-emoji-btn {
            width: 44px;
            height: 44px;
            border: 2px solid var(--border);
            border-radius: 8px;
            background: var(--background);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .mobile-device .mobile-emoji-btn:hover,
        .mobile-device .mobile-emoji-btn.active {
            border-color: var(--primary);
            background-color: var(--primary);
            transform: scale(1.05);
        }
        
        .mobile-device .mobile-fill-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
        }
        
        .mobile-device .mobile-fill-btn {
            padding: 0.75rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            background: var(--background);
            color: var(--foreground);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
        }
        
        .mobile-device .mobile-fill-btn:hover,
        .mobile-device .mobile-fill-btn.active {
            border-color: var(--primary);
            background-color: var(--primary);
            color: var(--primary-foreground);
        }
        
        /* 모바일 디버그 패널 */
        .mobile-device .mobile-debug-panel {
            position: fixed;
            top: 70px;
            left: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.95);
            border-radius: 12px;
            padding: 1rem;
            z-index: 200;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.8);
            max-height: 50vh;
            overflow-y: auto;
        }
        
        .mobile-device .mobile-debug-panel.show {
            display: block !important;
        }

        /* Hide elements initially if no image */
        .canvas-container.empty {
            background: transparent;
            box-shadow: none;
            padding: 2rem;
            text-align: center;
        }

        .empty-state {
            color: var(--muted-foreground);
            font-size: 1.125rem;
        }

        .empty-state .material-icons {
            font-size: 3rem;
            opacity: 0.5;
            margin-bottom: 1rem;
        }
    </style>
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3945001668113003" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4JDFWP6MTQ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-4JDFWP6MTQ');
    </script>
</head>
<body>
    <div class="app-container">
        <!-- Mobile Menu Button 제거됨 -->

        <!-- Mobile Overlay -->
        <div class="mobile-overlay" id="mobileOverlay"></div>

        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <!-- Sidebar Header -->
            <div class="sidebar-header">
                <div class="logo-section">
                    <span class="material-icons logo-icon">edit</span>
                    <h1 class="logo-text">
                        <span class="desktop-text">AnnotateShot
                    </h1>
                </div>
            </div>

            <!-- Sidebar Content -->
            <div class="sidebar-content">
                <!-- File Operations -->
                <div class="tool-panel">
                    <div class="panel-title">
                        <span class="material-icons">folder_open</span>
                        <span data-lang-key="fileOperations">파일 작업</span>
                    </div>
                    <div class="btn-group">
                        <input type="file" id="imageLoader" accept="image/*" aria-label="Upload image file">
                        <div class="btn-row">
                            <button class="btn" id="clipboardButton" aria-label="Paste image from clipboard" title="Paste from Clipboard" style="flex: 1; height: 2.5rem;">
                                <span class="material-icons">content_paste</span>
                                <span data-lang-key="pasteFromClipboard">클립보드에서 가져오기</span>
                            </button>
                            <button class="btn btn-icon success" id="saveButton" aria-label="Save annotated image" title="Save Image">
                                <span class="material-icons">download</span>
                            </button>
                            <button class="btn btn-icon" id="copyToClipboardButton" aria-label="Copy to clipboard" title="Copy to Clipboard">
                                <span class="material-icons">content_copy</span>
                            </button>
                            <button class="btn btn-icon" id="undoButton" aria-label="Undo last action">
                                <span class="material-icons">undo</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Canvas Settings -->
                <div class="tool-panel">
                    <div class="panel-title">
                        <span class="material-icons">palette</span>
                        <span data-lang-key="canvasSettings">캔버스 설정</span>
                    </div>
                    <div class="style-section">
                        <div class="style-subtitle" data-lang-key="canvasMode">캔버스 모드</div>
                        <select id="canvasModeSelector" aria-label="Select canvas mode">
                            <option value="single" data-lang-key="singleImageMode">싱글 이미지 편집</option>
                            <option value="multi" data-lang-key="multiImageMode">빈 캔버스 (멀티 이미지)</option>
                        </select>
                    </div>
                    <div class="style-section" id="backgroundColorSection" style="display: none;">
                        <div class="style-subtitle" data-lang-key="backgroundColor">배경색</div>
                        <select id="backgroundColorSelector" aria-label="Select background color">
                            <option value="" data-lang-key="pleaseSelect">배경색을 선택해주세요</option>
                            <option value="transparent" data-lang-key="transparent">투명</option>
                            <option value="white" data-lang-key="white">흰색</option>
                            <option value="light-gray" data-lang-key="lightGray">연한 회색</option>
                            <option value="gray" data-lang-key="gray">회색</option>
                            <option value="dark-gray" data-lang-key="darkGray">짙은 회색</option>
                        </select>
                    </div>
                    <div class="style-section" id="canvasSizeSection" style="display: none;">
                        <div class="style-subtitle" data-lang-key="canvasSize">캔버스 크기</div>
                        <select id="canvasSizeSelector" aria-label="Select canvas size">
                            <option value="" data-lang-key="pleaseSelectSize">캔버스 크기를 선택해주세요</option>
                            <option value="1920x1080" data-lang-key="size1920x1080">Full HD (1920×1080)</option>
                            <option value="1280x720" data-lang-key="size1280x720">HD (1280×720)</option>
                            <option value="1200x800" data-lang-key="size1200x800">웹 표준 (1200×800)</option>
                            <option value="800x600" data-lang-key="size800x600">클래식 (800×600)</option>
                            <option value="a4-landscape" data-lang-key="sizeA4Landscape">A4 가로 (297×210mm)</option>
                            <option value="a4-portrait" data-lang-key="sizeA4Portrait">A4 세로 (210×297mm)</option>
                            <option value="custom" data-lang-key="sizeCustom">사용자 정의</option>
                        </select>
                        <div id="customSizeSection" style="display: none; margin-top: 10px;">
                            <div style="display: flex; gap: 5px; align-items: center;">
                                <input type="number" id="customWidth" placeholder="가로" min="100" max="2000" style="width: 70px; padding: 5px; border: 1px solid #ddd; border-radius: 3px;">
                                <span>×</span>
                                <input type="number" id="customHeight" placeholder="세로" min="100" max="2000" style="width: 70px; padding: 5px; border: 1px solid #ddd; border-radius: 3px;">
                                <button id="applyCustomSize" style="padding: 5px 10px; border: 1px solid #ddd; border-radius: 3px; background: #f5f5f5; cursor: pointer;" data-lang-key="apply">적용</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Drawing Mode -->
                <div class="tool-panel">
                    <div class="panel-title">
                        <span class="material-icons">brush</span>
                        <span data-lang-key="annotationMode">주석 모드</span>
                    </div>
                    <div class="btn-group">
                        <select id="modeSelector" aria-label="Select annotation mode">
                            <option value="number" data-lang-key="numberMode">숫자 입력 모드</option>
                            <option value="shape" data-lang-key="shapeMode">도형 모드</option>
                            <option value="text" data-lang-key="textMode">텍스트 모드</option>
                            <option value="emoji" data-lang-key="emojiMode">이모지 모드</option>
                            <option value="crop" data-lang-key="cropMode">크롭 모드</option>
                        </select>
                    </div>
                </div>

                <!-- Style Panel -->
                <div class="tool-panel">
                    <div class="panel-title">
                        <span class="material-icons">palette</span>
                        <span data-lang-key="style">스타일</span>
                    </div>
                    
                    <!-- Color Section -->
                    <div class="style-section" id="colorSection">
                        <div class="style-subtitle" data-lang-key="color">색상</div>
                        <select id="colorSelector" aria-label="Select annotation color">
                            <option value="#FF0000" data-lang-key="red">빨간색</option>
                            <option value="#FF8000" data-lang-key="orange">주황색</option>
                            <option value="#00FF00" data-lang-key="green">녹색</option>
                            <option value="#0000FF" data-lang-key="blue">파랑색</option>
                        </select>
                    </div>
                    
                    <!-- Size Section -->
                    <div class="style-section" id="sizeSection">
                        <div class="style-subtitle" data-lang-key="size">크기</div>
                        <select id="sizeSelector" aria-label="Select annotation size">
                            <option value="10">10px</option>
                            <option value="15">15px</option>
                            <option value="20" selected>20px</option>
                            <option value="25">25px</option>
                            <option value="30">30px</option>
                            <option value="35">35px</option>
                            <option value="40">40px</option>
                            <option value="45">45px</option>
                            <option value="50">50px</option>
                            <option value="55">55px</option>
                            <option value="60">60px</option>
                            <option value="65">65px</option>
                            <option value="70">70px</option>
                        </select>
                    </div>
                    
                    <!-- Line Width Section (Shape mode only) -->
                    <div class="style-section" id="lineWidthSection" style="display: none;">
                        <div class="style-subtitle" data-lang-key="lineWidth">굵기</div>
                        <select id="lineWidthSelector" aria-label="Select line width">
                            <option value="1" data-lang-key="thin">얇음</option>
                            <option value="2" selected data-lang-key="normal">보통</option>
                            <option value="4" data-lang-key="thick">두꺼움</option>
                        </select>
                    </div>
                    
                    <!-- Shape Section (Shape mode only) -->
                    <div class="style-section" id="shapeSection" style="display: none;">
                        <div class="style-subtitle" data-lang-key="shape">모양</div>
                        <select id="shapeSelector" aria-label="Select shape type">
                            <option value="rectangle" data-lang-key="rectangle">사각형</option>
                            <option value="circle" data-lang-key="circle">원</option>
                            <option value="arrow" data-lang-key="arrow">화살표</option>
                        </select>
                    </div>
                    
                    <!-- Fill Section (Shape mode only, not for arrows) -->
                    <div class="style-section" id="fillSection" style="display: none;">
                        <div class="style-subtitle" data-lang-key="fill">채우기</div>
                        <select id="fillSelector" aria-label="Select fill type">
                            <option value="none" data-lang-key="fillNone">테두리만</option>
                            <option value="solid" data-lang-key="fillSolid">단색 채우기</option>
                            <option value="blur" data-lang-key="fillBlur">흐림 효과</option>
                            <option value="mosaic" data-lang-key="fillMosaic">모자이크</option>
                        </select>
                    </div>
                    
                    <!-- Emoji Section (Emoji mode only) -->
                    <div class="style-section" id="emojiSection" style="display: none;">
                        <div class="style-subtitle" data-lang-key="emojiType">이모지 종류</div>
                        <select id="emojiSelector" aria-label="Select emoji">
                            <option value="😀">😀</option>
                            <option value="😍">😍</option>
                            <option value="🤔">🤔</option>
                            <option value="👍">👍</option>
                            <option value="👎">👎</option>
                            <option value="❤️">❤️</option>
                            <option value="⭐">⭐</option>
                            <option value="🔥">🔥</option>
                            <option value="💯">💯</option>
                            <option value="✅">✅</option>
                            <option value="❌">❌</option>
                            <option value="⚠️">⚠️</option>
                        </select>
                    </div>

                    <!-- Crop Section (Crop mode only) -->
                    <div class="style-section" id="cropSection" style="display: none;">
                        <div class="style-subtitle" data-lang-key="cropStyle">크롭 스타일</div>
                        <select id="cropStyleSelector" aria-label="Select crop style">
                            <option value="basic" data-lang-key="cropBasic">기본 크롭</option>
                            <option value="torn" data-lang-key="cropTorn">찢어진 종이</option>
                        </select>
                    </div>

                    <!-- Crop Controls Section -->
                    <div class="style-section" id="cropControlsSection" style="display: none;">
                        <div class="style-subtitle" data-lang-key="cropControls">크롭 컨트롤</div>
                        <div class="btn-group">
                            <button id="applyCropButton" class="btn btn-primary" data-lang-key="applyCrop" disabled>크롭 적용</button>
                        </div>
                        <div class="crop-info" id="cropInfo" style="display: none; margin-top: 8px; font-size: 12px; color: #666;">
                            <span data-lang-key="cropInstruction">드래그하여 크롭 영역을 선택하세요</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar Footer -->
            <div class="sidebar-footer" style="padding: 1rem; border-top: 1px solid var(--border);">
                <div class="btn-group">
                    
                    <!-- Language Selector -->
                    <div style="margin-top: 1rem;">
                         <label for="languageSelector" style="font-size: 0.875rem; color: var(--muted-foreground); margin-bottom: 0.5rem; display: block;">Language</label>
                         <select id="languageSelector" aria-label="Select language" style="width: 100%;">
                             <option value="ko">한국어</option>
                             <option value="en">English</option>
                         </select>
                    </div>
                    
                    <!-- Footer Links -->
                    <div class="footer-links" style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border);">
                        <a href="changelog.html" target="_blank" class="btn footer-link">
                            <span class="material-icons">description</span>
                            <span data-lang-key="releaseNotes">Release Notes</span>
                        </a>
                        
                        <a href="delcodelinenum.html" class="btn footer-link">
                            <span class="material-icons">code</span>
                            <span data-lang-key="codeLineRemover">Code Line Remover</span>
                        </a>
                        
                        <a href="index-legacy.html" class="btn footer-link">
                            <span class="material-icons">history</span>
                            <span data-lang-key="legacyVersion">Legacy Version</span>
                        </a>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Bar -->
            <header class="top-bar">
                <h2 data-lang-key="editImage">이미지 편집</h2>
                <div class="top-bar-actions">
                    <!-- Chrome Extension Link -->
                    <a href="https://chromewebstore.google.com/detail/annotateshot-capture/edngphlkihgcpcolnjadgopgkpfhdcce" target="_blank" class="chrome-extension-link" title="Chrome Extension으로 웹페이지 캡처하기" style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1.25rem; background: linear-gradient(135deg, #4285f4, #34a853); color: white; text-decoration: none; border-radius: 6px; font-size: 0.875rem; margin-right: 1rem; transition: all 0.2s ease; white-space: nowrap;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2c5.52 0 10 4.48 10 10s-4.48 10-10 10S2 17.52 2 12 6.48 2 12 2zm3.5 6L12 10.5 8.5 8 6 12l2.5 4 3.5-2.5L15.5 16l2.5-4-2.5-4z"/>
                        </svg>
                        <span data-lang-key="chromeExtension" class="chrome-extension-text">Chrome Extension</span>
                    </a>
                    <label for="resizeSelector" style="font-size: 0.875rem; color: var(--muted-foreground); margin-right: 0.5rem; pointer-events: none; white-space: nowrap;" data-lang-key="imageSize">이미지 크기:</label>
                    <select id="resizeSelector" aria-label="Select image resize option" class="top-resize-selector" onclick="event.stopPropagation();">
                        <option value="default" data-lang-key="autoResize">자동 리사이즈 (기본)</option>
                        <option value="original" data-lang-key="originalSize">원본</option>
                        <option value="300" data-lang-key="width300">너비 300</option>
                        <option value="600" data-lang-key="width600">너비 600</option>
                        <option value="900" data-lang-key="width900">너비 900</option>
                        <option value="scale30" data-lang-key="scale30">원본 대비 30% 축소</option>
                        <option value="scale50" data-lang-key="scale50">원본 대비 50% 축소</option>
                        <option value="scale70" data-lang-key="scale70">원본 대비 70% 축소</option>
                    </select>
                    <button class="btn btn-icon" id="themeToggle" aria-label="Toggle theme">
                        <span class="material-icons">dark_mode</span>
                    </button>
                </div>
            </header>

            <!-- Canvas Area -->
            <div class="canvas-area">
                <!-- PC 전용 캔버스 -->
                <div class="canvas-container empty desktop-canvas" id="canvasContainer">
                    <div class="empty-state" id="emptyState">
                        <div class="material-icons">image</div>
                        <div id="uploadPromptText" data-lang-key="uploadImagePrompt">이미지를 업로드하거나 클립보드에서 붙여넣기하세요</div>
                    </div>
                    <canvas id="imageCanvas" style="display: none;"></canvas>
                </div>
                
                <!-- 모바일 전용 캔버스 -->
                <div class="canvas-container empty mobile-canvas" id="mobileCanvasContainer">
                    <div class="empty-state mobile-empty-state" id="mobileEmptyState">
                        <div class="material-icons">image</div>
                        <div id="mobileUploadPromptText" class="mobile-prompt-text">
                            AnnotateShot 모바일 사용법<br>
                            1. 하단 📷 버튼으로 갤러리에서 이미지를 불러오세요<br>
                            2. 숫자 모드: 화면을 터치하여 순차 번호 추가<br>
                            3. 이모지 모드: 하단 😀 버튼으로 선택 후 터치하여 추가<br>
                            4. 텍스트 모드: 화면을 터치하면 텍스트 입력창이 나타남<br>
                            5. 끌어서 이동: 모든 주석을 드래그하여 위치 이동 가능<br>
                            6. 우측 상단 💾 버튼으로 완성된 이미지를 저장하세요
                        </div>
                    </div>
                    <canvas id="mobileImageCanvas" style="display: none;"></canvas>
                </div>
            </div>

            <!-- Status Bar -->
            <footer class="status-bar">
                <div class="status-info" id="statusInfo">
                    <span id="statusText" data-lang-key="mouseMovePrompt">마우스를 움직여보세요</span>
                </div>
            </footer>
        </main>

        <!-- Right Layer Sidebar -->
        <aside class="layer-sidebar" id="layerSidebar">
            <div class="layer-sidebar-header">
                <div class="layer-sidebar-header-content">
                    <span class="material-icons">layers</span>
                    <h3 data-lang-key="layers">레이어</h3>
                </div>
            </div>
            
            <div class="layer-sidebar-content">
                <div class="layer-list" id="layerList">
                    <div class="layer-item background-layer">
                        <div class="layer-info">
                            <span class="material-icons layer-icon">image</span>
                            <span class="layer-name" data-lang-key="backgroundLayer">배경 이미지</span>
                        </div>
                        <div class="layer-controls">
                            <button class="layer-visibility-toggle" aria-label="Toggle visibility">
                                <span class="material-icons">visibility</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="layer-actions">
                    <button class="btn btn-sm" id="clearAllLayers" data-lang-key="clearAllLayers">
                        <span class="material-icons">clear_all</span>
                        모든 레이어 지우기
                    </button>
                </div>
            </div>
        </aside>
    </div>

    <!-- Message -->
    <div id="message"></div>

    <script src="./src/main.js"></script>
    
    <script>
        // Theme Toggle Functionality
        function initializeTheme() {
            const themeToggle = document.getElementById('themeToggle');
            const body = document.body;
            const themeIcon = themeToggle.querySelector('.material-icons');
            
            // Check for saved theme or default to light
            const savedTheme = localStorage.getItem('theme') || 'light';
            if (savedTheme === 'dark') {
                body.classList.add('dark');
                themeIcon.textContent = 'light_mode';
            } else {
                themeIcon.textContent = 'dark_mode';
            }
            
            themeToggle.addEventListener('click', () => {
                body.classList.toggle('dark');
                const isDark = body.classList.contains('dark');
                themeIcon.textContent = isDark ? 'light_mode' : 'dark_mode';
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
            });
        }

        // Mobile Sidebar Functionality - User Agent 기반
        function initializeSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const mobileOverlay = document.getElementById('mobileOverlay');
            
            // User Agent 기반 모바일 감지 (main.js에서 이미 설정됨)
            function isMobileDevice() {
                const userAgent = navigator.userAgent.toLowerCase();
                const mobileKeywords = [
                    'android', 'webos', 'iphone', 'ipad', 'ipod', 
                    'blackberry', 'windows phone', 'mobile', 'opera mini'
                ];
                return mobileKeywords.some(keyword => userAgent.includes(keyword));
            }
            
            const isMobile = isMobileDevice();
            
            // 모바일 기기에서만 모바일 UI 활성화
            if (isMobile) {
                console.log('모바일 UI 활성화 - 사이드바 기능 초기화');
                
                mobileMenuBtn.addEventListener('click', () => {
                    sidebar.classList.toggle('mobile-open');
                    mobileOverlay.classList.toggle('show');
                });
                
                mobileOverlay.addEventListener('click', () => {
                    sidebar.classList.remove('mobile-open');
                    mobileOverlay.classList.remove('show');
                });
                
                // 모바일에서 뒤로가기 버튼으로 사이드바 닫기
                window.addEventListener('popstate', () => {
                    sidebar.classList.remove('mobile-open');
                    mobileOverlay.classList.remove('show');
                });
            } else {
                console.log('데스크톱 UI - 모바일 기능 비활성화');
            }
            
            // 캔버스 리사이즈는 모든 기기에서 동작 (브라우저 크기 변경 시)
            window.addEventListener('resize', () => {
                // Canvas resize trigger는 유지
                if (typeof window.triggerCanvasResize === 'function') {
                    clearTimeout(window.resizeTimeout);
                    window.resizeTimeout = setTimeout(() => {
                        window.triggerCanvasResize();
                    }, 100);
                }
            });
        }

        // Layer Sidebar Functionality
        function initializeLayerSidebar() {
            const layerSidebar = document.getElementById('layerSidebar');
            const layerList = document.getElementById('layerList');
            const clearAllLayersBtn = document.getElementById('clearAllLayers');
            
            // Initialize background layer visibility toggle
            const backgroundLayerToggle = layerList.querySelector('.background-layer .layer-visibility-toggle');
            if (backgroundLayerToggle) {
                backgroundLayerToggle.addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleBackgroundLayerVisibility();
                });
            }
            
            // Clear all layers functionality
            clearAllLayersBtn.addEventListener('click', () => {
                if (confirm('모든 주석을 삭제하시겠습니까?')) {
                    if (typeof window.clearAllAnnotations === 'function') {
                        window.clearAllAnnotations();
                    } else {
                        console.error('clearAllAnnotations function not available');
                    }
                }
            });
            
            // Update layer list based on new layer system
            function updateLayerList() {
                console.log('Updating layer list...');
                
                // Clear existing layers
                const existingLayers = layerList.querySelectorAll('.layer-item');
                existingLayers.forEach(item => item.remove());
                
                // Get data from main.js
                const layers = window.layers || [];
                const imageLayers = window.imageLayers || [];
                console.log('Layers:', layers.length, 'ImageLayers:', imageLayers.length);
                
                // 1. Add background layer (solid color)
                addBackgroundLayer();
                
                // 2. Add image layers
                imageLayers.forEach((imageLayer, index) => {
                    addImageLayerToUI(imageLayer, index);
                });
                
                // 3. Add annotation layers in reverse order (top layer first in UI)
                const annotationLayers = layers.filter(layer => layer.type !== 'background');
                for (let i = annotationLayers.length - 1; i >= 0; i--) {
                    const layer = annotationLayers[i];
                    addAnnotationLayerToUI(layer, i);
                }
                
                console.log('Layer list updated successfully');
            }
            
            function addBackgroundLayer() {
                const backgroundItem = document.createElement('div');
                backgroundItem.className = 'layer-item background-layer';
                backgroundItem.setAttribute('data-layer-type', 'background');
                
                const layerContent = document.createElement('div');
                layerContent.className = 'layer-info';
                
                const icon = document.createElement('span');
                icon.className = 'material-icons layer-icon';
                icon.textContent = 'layers';
                
                const name = document.createElement('span');
                name.className = 'layer-name';
                name.textContent = '배경';
                
                const controls = document.createElement('div');
                controls.className = 'layer-controls';
                
                // 배경 레이어는 항상 보임, 삭제 불가
                const visibilityBtn = document.createElement('button');
                visibilityBtn.className = 'layer-visibility-toggle';
                visibilityBtn.innerHTML = '<span class="material-icons">visibility</span>';
                visibilityBtn.disabled = true;
                visibilityBtn.style.opacity = '0.3';
                
                controls.appendChild(visibilityBtn);
                
                layerContent.appendChild(icon);
                layerContent.appendChild(name);
                backgroundItem.appendChild(layerContent);
                backgroundItem.appendChild(controls);
                
                layerList.appendChild(backgroundItem);
            }
            
            function addImageLayerToUI(imageLayer, index) {
                const layerItem = document.createElement('div');
                layerItem.className = 'layer-item image-layer';
                layerItem.setAttribute('data-image-layer-id', imageLayer.id);
                
                const layerContent = document.createElement('div');
                layerContent.className = 'layer-info';
                
                const icon = document.createElement('span');
                icon.className = 'material-icons layer-icon';
                icon.textContent = 'image';
                
                const name = document.createElement('span');
                name.className = 'layer-name';
                name.textContent = `이미지 레이어 ${index + 1}`;
                
                const controls = document.createElement('div');
                controls.className = 'layer-controls';
                
                // Visibility toggle
                const visibilityBtn = document.createElement('button');
                visibilityBtn.className = 'layer-visibility-toggle';
                const visibilityIcon = imageLayer.visible !== false ? 'visibility' : 'visibility_off';
                visibilityBtn.innerHTML = `<span class="material-icons">${visibilityIcon}</span>`;
                if (imageLayer.visible === false) {
                    visibilityBtn.classList.add('hidden');
                }
                visibilityBtn.onclick = (e) => {
                    e.stopPropagation();
                    toggleImageLayerVisibility(imageLayer.id);
                };
                
                // Delete button
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'layer-visibility-toggle';
                deleteBtn.innerHTML = '<span class="material-icons">delete</span>';
                deleteBtn.onclick = (e) => {
                    e.stopPropagation();
                    deleteImageLayer(imageLayer.id);
                };
                
                controls.appendChild(visibilityBtn);
                controls.appendChild(deleteBtn);
                
                layerContent.appendChild(icon);
                layerContent.appendChild(name);
                layerItem.appendChild(layerContent);
                layerItem.appendChild(controls);
                
                layerList.appendChild(layerItem);
            }
            
            function addAnnotationLayerToUI(layer, index) {
                const layerItem = createLayerItem(layer, index);
                layerList.appendChild(layerItem);
            }
            
            function createLayerItem(layer, displayIndex) {
                const layerItem = document.createElement('div');
                layerItem.className = 'layer-item annotation-layer';
                layerItem.dataset.layerId = layer.id;
                
                const layerInfo = document.createElement('div');
                layerInfo.className = 'layer-info';
                
                const icon = document.createElement('span');
                icon.className = 'material-icons layer-icon';
                icon.textContent = getLayerIcon(layer.type);
                
                const name = document.createElement('span');
                name.className = 'layer-name';
                name.textContent = layer.name || getLayerName(layer, displayIndex);
                
                const controls = document.createElement('div');
                controls.className = 'layer-controls';
                
                const visibilityToggle = document.createElement('button');
                visibilityToggle.className = 'layer-visibility-toggle';
                if (layer.visible === false) {
                    visibilityToggle.classList.add('hidden');
                }
                const visibilityIcon = layer.visible === false ? 'visibility_off' : 'visibility';
                visibilityToggle.innerHTML = `<span class="material-icons">${visibilityIcon}</span>`;
                visibilityToggle.addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleLayerVisibility(layer.id);
                });
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'layer-visibility-toggle';
                deleteBtn.innerHTML = '<span class="material-icons">delete</span>';
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    deleteLayer(layer.id);
                });
                
                layerInfo.appendChild(icon);
                layerInfo.appendChild(name);
                controls.appendChild(visibilityToggle);
                controls.appendChild(deleteBtn);
                layerItem.appendChild(layerInfo);
                layerItem.appendChild(controls);
                
                // Layer click to select
                layerItem.addEventListener('click', () => {
                    selectLayerById(layer.id);
                });
                
                return layerItem;
            }
            
            function getLayerIcon(type) {
                const icons = {
                    number: 'looks_one',
                    shape: 'crop_square',
                    text: 'text_fields',
                    emoji: 'emoji_emotions'
                };
                return icons[type] || 'layers';
            }
            
            function getLayerName(annotation, index) {
                const typeNames = {
                    number: '숫자',
                    shape: '도형',
                    text: '텍스트',
                    emoji: '이모지'
                };
                const baseName = typeNames[annotation.type] || '요소';
                return `${baseName} ${index + 1}`;
            }
            
            function selectLayer(index) {
                // Remove previous selection
                document.querySelectorAll('.layer-item.selected').forEach(item => {
                    item.classList.remove('selected');
                });
                
                // Select new layer
                const layerItem = document.querySelector(`[data-index="${index}"]`);
                if (layerItem) {
                    layerItem.classList.add('selected');
                }
            }
            
            function toggleAnnotationVisibility(index) {
                if (clicks[index]) {
                    clicks[index].visible = clicks[index].visible !== false ? false : true;
                    redrawCanvas();
                    updateLayerList();
                }
            }
            
            function deleteAnnotation(index) {
                if (clicks[index]) {
                    clicks.splice(index, 1);
                    redrawCanvas();
                    updateLayerList();
                }
            }
            
            
            // Background layer visibility toggle
            function toggleBackgroundLayerVisibility() {
                console.log('Toggling background layer visibility');
                if (window.layers) {
                    const backgroundLayer = window.layers.find(layer => layer.type === 'background');
                    console.log('Found background layer:', backgroundLayer);
                    if (backgroundLayer) {
                        backgroundLayer.visible = !backgroundLayer.visible;
                        console.log('New visibility state:', backgroundLayer.visible);
                        if (typeof window.redrawCanvas === 'function') {
                            window.redrawCanvas();
                        }
                        updateLayerList();
                    }
                }
            }
            
            // Layer visibility toggle by ID
            function toggleLayerVisibility(layerId) {
                if (window.layers) {
                    const layer = window.layers.find(l => l.id === layerId);
                    if (layer) {
                        layer.visible = !layer.visible;
                        if (typeof window.redrawCanvas === 'function') {
                            window.redrawCanvas();
                        }
                        updateLayerList();
                    }
                }
            }
            
            // Delete layer by ID
            function deleteLayer(layerId) {
                console.log('Deleting layer with ID:', layerId);
                if (window.layers) {
                    const layerIndex = window.layers.findIndex(l => l.id === layerId);
                    console.log('Found layer at index:', layerIndex);
                    if (layerIndex !== -1) {
                        const layer = window.layers[layerIndex];
                        console.log('Layer to delete:', layer);
                        
                        // Also remove from clicks array
                        const clickIndex = window.clicks.findIndex(click => click === layer.data);
                        console.log('Found corresponding click at index:', clickIndex);
                        console.log('Clicks array before:', window.clicks.length);
                        
                        if (clickIndex !== -1) {
                            window.clicks.splice(clickIndex, 1);
                        }
                        
                        console.log('Clicks array after:', window.clicks.length);
                        
                        window.layers.splice(layerIndex, 1);
                        console.log('Layers array after:', window.layers.length);
                        
                        if (typeof window.redrawCanvas === 'function') {
                            window.redrawCanvas();
                        }
                        updateLayerList();
                    }
                }
            }
            
            // Image layer control functions
            function toggleImageLayerVisibility(imageLayerId) {
                if (window.imageLayers) {
                    const imageLayer = window.imageLayers.find(layer => layer.id === imageLayerId);
                    if (imageLayer) {
                        imageLayer.visible = !imageLayer.visible;
                        if (typeof window.redrawCanvas === 'function') {
                            window.redrawCanvas();
                        }
                        updateLayerList();
                    }
                }
            }
            
            function deleteImageLayer(imageLayerId) {
                if (window.imageLayers) {
                    const layerIndex = window.imageLayers.findIndex(layer => layer.id === imageLayerId);
                    if (layerIndex !== -1) {
                        window.imageLayers.splice(layerIndex, 1);
                        
                        // Also remove from legacy layers system
                        if (window.layers) {
                            const legacyIndex = window.layers.findIndex(l => l.type === 'background');
                            if (legacyIndex !== -1) {
                                window.layers.splice(legacyIndex, 1);
                            }
                        }
                        
                        if (typeof window.redrawCanvas === 'function') {
                            window.redrawCanvas();
                        }
                        updateLayerList();
                    }
                }
            }
            
            // Select layer by ID
            function selectLayerById(layerId) {
                // Remove previous selection
                document.querySelectorAll('.layer-item.selected').forEach(item => {
                    item.classList.remove('selected');
                });
                
                // Select new layer
                const layerItem = document.querySelector(`[data-layer-id="${layerId}"]`);
                if (layerItem) {
                    layerItem.classList.add('selected');
                }
            }
            
            // Expose updateLayerList globally for main.js to call
            window.updateLayerList = updateLayerList;
        }

        // Canvas Container State Management
        function updateCanvasContainer() {
            const canvas = document.getElementById('imageCanvas');
            const container = document.getElementById('canvasContainer');
            const emptyState = document.getElementById('emptyState');
            
            if (canvas.width > 0 && canvas.height > 0) {
                container.classList.remove('empty');
                emptyState.style.display = 'none';
                canvas.style.display = 'block';
            } else {
                container.classList.add('empty');
                emptyState.style.display = 'block';
                canvas.style.display = 'none';
            }
        }

        // Mode-specific control visibility
        function updateControlsVisibility() {
            const modeSelector = document.getElementById('modeSelector');
            const colorSection = document.getElementById('colorSection');
            const sizeSection = document.getElementById('sizeSection');
            const lineWidthSection = document.getElementById('lineWidthSection');
            const shapeSection = document.getElementById('shapeSection');
            const fillSection = document.getElementById('fillSection');
            const emojiSection = document.getElementById('emojiSection');
            const cropSection = document.getElementById('cropSection');
            const cropControlsSection = document.getElementById('cropControlsSection');
            const shapeSelector = document.getElementById('shapeSelector');
            const stylePanel = document.querySelector('.tool-panel:has(#colorSection)');
            
            const currentMode = modeSelector.value;
            
            // Hide all sections first
            colorSection.style.display = 'none';
            sizeSection.style.display = 'none';
            lineWidthSection.style.display = 'none';
            shapeSection.style.display = 'none';
            fillSection.style.display = 'none';
            emojiSection.style.display = 'none';
            cropSection.style.display = 'none';
            cropControlsSection.style.display = 'none';
            
            // Reorder and show sections based on current mode
            switch(currentMode) {
                case 'number':
                    // 숫자 모드: 색상, 크기
                    stylePanel.appendChild(colorSection);
                    stylePanel.appendChild(sizeSection);
                    colorSection.style.display = 'block';
                    sizeSection.style.display = 'block';
                    break;
                    
                case 'shape':
                    // 도형 모드: 모양, 색상, 굵기, 채우기 (화살표 제외)
                    stylePanel.appendChild(shapeSection);
                    stylePanel.appendChild(colorSection);
                    stylePanel.appendChild(lineWidthSection);
                    stylePanel.appendChild(fillSection);
                    
                    shapeSection.style.display = 'block';
                    colorSection.style.display = 'block';
                    lineWidthSection.style.display = 'block';
                    
                    // Show fill section only if not arrow
                    const currentShape = shapeSelector.value;
                    if (currentShape !== 'arrow') {
                        fillSection.style.display = 'block';
                    }
                    break;
                    
                case 'text':
                    // 텍스트 모드: 색상, 크기
                    stylePanel.appendChild(colorSection);
                    stylePanel.appendChild(sizeSection);
                    colorSection.style.display = 'block';
                    sizeSection.style.display = 'block';
                    break;
                    
                case 'emoji':
                    // 이모지 모드: 이모지 종류, 크기 (색상 제외)
                    stylePanel.appendChild(emojiSection);
                    stylePanel.appendChild(sizeSection);
                    emojiSection.style.display = 'block';
                    sizeSection.style.display = 'block';
                    break;
                    
                case 'crop':
                    // 크롭 모드: 크롭 스타일, 컨트롤
                    stylePanel.appendChild(cropSection);
                    stylePanel.appendChild(cropControlsSection);
                    cropSection.style.display = 'block';
                    cropControlsSection.style.display = 'block';
                    
                    // 크롭 버튼 상태 업데이트
                    if (typeof updateCropButtonStates === 'function') {
                        updateCropButtonStates();
                    }
                    break;
            }
        }

        // Handle shape selector changes to update fill selector visibility
        function initializeModeControls() {
            const modeSelector = document.getElementById('modeSelector');
            const shapeSelector = document.getElementById('shapeSelector');
            
            // Update controls when mode changes
            modeSelector.addEventListener('change', () => {
                updateControlsVisibility();
                // Force sync with main.js mode variable
                if (window.currentMode !== undefined) {
                    window.currentMode = modeSelector.value;
                }
            });
            
            // Update fill section when shape changes
            shapeSelector.addEventListener('change', () => {
                const fillSection = document.getElementById('fillSection');
                const currentShape = shapeSelector.value;
                
                // Hide fill section for arrows since they don't support fill
                if (currentShape === 'arrow') {
                    fillSection.style.display = 'none';
                } else if (modeSelector.value === 'shape') {
                    fillSection.style.display = 'block';
                }
                
                // Force sync with main.js shape variable
                if (window.currentShape !== undefined) {
                    window.currentShape = shapeSelector.value;
                }
            });
            
            // Sync initial state with main.js variables
            if (window.currentMode !== undefined) {
                modeSelector.value = window.currentMode;
            }
            if (window.currentShape !== undefined) {
                shapeSelector.value = window.currentShape;
            }
            
            // Initialize visibility
            updateControlsVisibility();
        }

        // Status logging functionality
        function updateStatus(message) {
            const statusText = document.getElementById('statusText');
            if (statusText) {
                statusText.textContent = message;
            }
        }

        function initializeStatusLogging() {
            const canvas = document.getElementById('imageCanvas');
            const canvasContainer = document.getElementById('canvasContainer');
            
            // Track mouse movement on canvas area only (not on top-bar)
            canvasContainer.addEventListener('mousemove', (e) => {
                // Check if mouse is over top-bar area
                const topBar = document.querySelector('.top-bar');
                const topBarRect = topBar.getBoundingClientRect();
                
                if (e.clientY >= topBarRect.top && e.clientY <= topBarRect.bottom) {
                    return; // Don't track if mouse is over top-bar
                }
                
                const rect = canvas.getBoundingClientRect();
                const x = Math.round(e.clientX - rect.left);
                const y = Math.round(e.clientY - rect.top);
                
                if (x >= 0 && y >= 0 && x <= canvas.width && y <= canvas.height) {
                    updateStatus(`좌표: (${x}, ${y})`);
                } else {
                    updateStatus('캔버스 영역 외부');
                }
            });

            // Track mouse leave
            canvasContainer.addEventListener('mouseleave', () => {
                updateStatus('대기 중');
            });

            // Track canvas clicks
            canvas.addEventListener('click', (e) => {
                const rect = canvas.getBoundingClientRect();
                const x = Math.round(e.clientX - rect.left);
                const y = Math.round(e.clientY - rect.top);
                const modeSelector = document.getElementById('modeSelector');
                const currentMode = modeSelector.value;
                
                updateStatus(`${getModeDisplayName(currentMode)} 추가됨: (${x}, ${y})`);
                
                // Clear status after 3 seconds
                setTimeout(() => {
                    updateStatus('대기 중');
                }, 3000);
            });

            // Track mode changes
            const modeSelector = document.getElementById('modeSelector');
            modeSelector.addEventListener('change', () => {
                const modeName = getModeDisplayName(modeSelector.value);
                updateStatus(`모드 변경: ${modeName}`);
                
                setTimeout(() => {
                    updateStatus('대기 중');
                }, 2000);
            });

            // Track emoji selector changes
            const emojiSelector = document.getElementById('emojiSelector');
            emojiSelector.addEventListener('change', () => {
                updateStatus(`이모지 선택: ${emojiSelector.value}`);
                
                setTimeout(() => {
                    updateStatus('대기 중');
                }, 2000);
            });

            // Track shape selector changes
            const shapeSelector = document.getElementById('shapeSelector');
            shapeSelector.addEventListener('change', () => {
                const shapeName = getShapeDisplayName(shapeSelector.value);
                updateStatus(`도형 선택: ${shapeName}`);
                
                setTimeout(() => {
                    updateStatus('대기 중');
                }, 2000);
            });

            // Track color changes
            const colorSelector = document.getElementById('colorSelector');
            colorSelector.addEventListener('change', () => {
                const colorName = getColorDisplayName(colorSelector.value);
                updateStatus(`색상 변경: ${colorName}`);
                
                setTimeout(() => {
                    updateStatus('대기 중');
                }, 2000);
            });

            // Track save action
            const saveButton = document.getElementById('saveButton');
            saveButton.addEventListener('click', () => {
                updateStatus('이미지 저장됨');
                
                setTimeout(() => {
                    updateStatus('대기 중');
                }, 3000);
            });

            // Track undo action
            const undoButton = document.getElementById('undoButton');
            undoButton.addEventListener('click', () => {
                updateStatus('실행 취소됨');
                
                setTimeout(() => {
                    updateStatus('대기 중');
                }, 2000);
            });
        }

        // Multi-language support functions
        function getLanguage() {
            // Priority: 1. localStorage, 2. browser language, 3. default 'en'
            const savedLang = localStorage.getItem('language');
            if (savedLang) return savedLang;

            const browserLang = navigator.language || navigator.userLanguage;
            if (browserLang.startsWith('ko')) return 'ko';
            
            return 'en';
        }

        function setLanguage(lang) {
            localStorage.setItem('language', lang);
            updateUILanguage();
        }

        function translate(key, params = {}) {
            const translations = {
                'ko': {
                    'fileOperations': '파일 작업',
                    'pasteFromClipboard': '클립보드에서 가져오기',
                    'canvasSettings': '캔버스 설정',
                    'canvasMode': '캔버스 모드',
                    'singleImageMode': '싱글 이미지 편집',
                    'multiImageMode': '빈 캔버스 (멀티 이미지)',
                    'backgroundColor': '배경색',
                    'canvasSize': '캔버스 크기',
                    'size1920x1080': 'Full HD (1920×1080)',
                    'size1280x720': 'HD (1280×720)',
                    'size1200x800': '웹 표준 (1200×800)',
                    'size800x600': '클래식 (800×600)',
                    'sizeA4Landscape': 'A4 가로 (297×210mm)',
                    'sizeA4Portrait': 'A4 세로 (210×297mm)',
                    'sizeCustom': '사용자 정의',
                    'apply': '적용',
                    'white': '흰색',
                    'lightGray': '연한 회색',
                    'gray': '회색',
                    'darkGray': '짙은 회색',
                    'transparent': '투명',
                    'annotationMode': '주석 모드',
                    'numberMode': '숫자 입력 모드',
                    'shapeMode': '도형 모드',
                    'textMode': '텍스트 모드',
                    'emojiMode': '이모지 모드',
                    'cropMode': '크롭 모드',
                    'style': '스타일',
                    'color': '색상',
                    'red': '빨간색',
                    'orange': '주황색',
                    'green': '녹색',
                    'blue': '파랑색',
                    'size': '크기',
                    'lineWidth': '굵기',
                    'thin': '얇음',
                    'normal': '보통',
                    'thick': '두꺼움',
                    'shape': '모양',
                    'rectangle': '사각형',
                    'circle': '원',
                    'arrow': '화살표',
                    'fill': '채우기',
                    'fillNone': '테두리만',
                    'fillSolid': '단색 채우기',
                    'fillBlur': '흐림 효과',
                    'fillMosaic': '모자이크',
                    'emojiType': '이모지 종류',
                    'cropStyle': '크롭 스타일',
                    'cropBasic': '기본 크롭',
                    'cropShadow': '그림자 효과',
                    'cropRounded': '둥근 모서리',
                    'cropTorn': '찢어진 종이',
                    'cropCurtain': '극장 커튼',
                    'cropControls': '크롭 컨트롤',
                    'applyCrop': '크롭 적용',
                    'cancelCrop': '크롭 취소',
                    'layers': '레이어',
                    'backgroundLayer': '배경 이미지',
                    'clearAllLayers': '모든 레이어 지우기',
                    'cropInstruction': '드래그하여 크롭 영역을 선택하세요',
                    'undo': '실행 취소',
                    'save': '저장하기',
                    'toggleTheme': '테마 변경',
                    'language': '언어',
                    'releaseNotes': '릴리즈 노트',
                    'codeLineRemover': '코드 라인 제거기',
                    'legacyVersion': '레거시 버전',
                    'chromeExtension': 'Chrome 확장 프로그램',
                    'editImage': '이미지 편집',
                    'imageSize': '이미지 크기:',
                    'autoResize': '자동 리사이즈 (기본)',
                    'originalSize': '원본',
                    'width300': '너비 300',
                    'width600': '너비 600',
                    'width900': '너비 900',
                    'scale30': '원본 대비 30% 축소',
                    'scale50': '원본 대비 50% 축소',
                    'scale70': '원본 대비 70% 축소',
                    'uploadImagePrompt': 'AnnotateShot 서비스 이용 방법\n1. 번호, 도형, 텍스트를 입력해야하는 이미지를 불러오세요. 클립보드 이미지도 가능합니다.\n2. 아무곳이나 클릭해보세요.\n3. 저장이 필요하면 저장하기 버튼을 눌러서 로컬 PC로 저장할 수 있습니다. 혹은 이미지 우측 클릭 후 이미지 복사를 하셔도 괜찮습니다.',
                    'mobileUploadImagePrompt': 'AnnotateShot 모바일 사용법\n1. 좌측 🖼️ 버튼으로 사진을 찍거나 갤러리에서 이미지를 불러오세요\n2. 숫자 모드: 화면을 터치하여 순차 번호 추가\n3. 이모지 모드: 하단 😀 버튼으로 선택 후 터치하여 추가\n4. 텍스트 모드: 화면을 터치하면 텍스트 입력창이 나타남\n5. 끌어서 이동: 모든 주석을 드래그하여 위치 이동 가능\n6. 우측 💾 버튼으로 완성된 이미지를 저장하세요',
                    'blankCanvasPrompt': '빈 캔버스 모드 (멀티 이미지)\n1. 배경색을 선택하세요.\n2. 여러 이미지를 업로드하여 레이어로 구성하세요.\n3. 각 이미지를 드래그하여 위치를 조정할 수 있습니다.',
                    'imageLoaded': '이미지 로드됨: {width} x {height}',
                    'imageLayerAdded': '이미지 레이어 {layerNumber} 추가됨: {width} x {height}',
                    'mouseMovePrompt': '마우스를 움직여보세요',
                    'statusCoordinates': '좌표: ({x}, {y})',
                    'statusOutsideCanvas': '캔버스 영역 외부',
                    'statusWaiting': '대기 중',
                    'statusModeChanged': '모드 변경: {modeName}',
                    'statusEmojiSelected': '이모지 선택: {emoji}',
                    'statusShapeSelected': '도형 선택: {shapeName}',
                    'statusColorChanged': '색상 변경: {colorName}',
                    'statusImageSaved': '이미지 저장됨',
                    'statusUndo': '실행 취소됨',
                    'statusAdded': '{modeName} 추가됨: ({x}, {y})',
                    'cropTooSmall': '크롭 영역이 너무 작습니다 (최소 10×10 픽셀)',
                    'cropSelected': '크롭 영역이 선택되었습니다. 스타일을 선택하고 적용 버튼을 눌러주세요.',
                    'cropApplied': '크롭이 적용되었습니다',
                    'cropCancelled': '크롭이 취소되었습니다',
                    'enterText': '텍스트를 입력하세요',
                    'textAdded': '텍스트 "{text}" 추가됨: ({x}, {y})',
                    'emojiAdded': '이모지 {emoji} 추가됨: ({x}, {y})'
                },
                'en': {
                    'fileOperations': 'File Operations',
                    'pasteFromClipboard': 'Paste from Clipboard',
                    'canvasSettings': 'Canvas Settings',
                    'canvasMode': 'Canvas Mode',
                    'singleImageMode': 'Single Image Edit',
                    'multiImageMode': 'Blank Canvas (Multi Image)',
                    'backgroundColor': 'Background Color',
                    'canvasSize': 'Canvas Size',
                    'size1920x1080': 'Full HD (1920×1080)',
                    'size1280x720': 'HD (1280×720)',
                    'size1200x800': 'Web Standard (1200×800)',
                    'size800x600': 'Classic (800×600)',
                    'sizeA4Landscape': 'A4 Landscape (297×210mm)',
                    'sizeA4Portrait': 'A4 Portrait (210×297mm)',
                    'sizeCustom': 'Custom',
                    'apply': 'Apply',
                    'white': 'White',
                    'lightGray': 'Light Gray',
                    'gray': 'Gray',
                    'darkGray': 'Dark Gray',
                    'transparent': 'Transparent',
                    'annotationMode': 'Annotation Mode',
                    'numberMode': 'Number Mode',
                    'shapeMode': 'Shape Mode',
                    'textMode': 'Text Mode',
                    'emojiMode': 'Emoji Mode',
                    'cropMode': 'Crop Mode',
                    'style': 'Style',
                    'color': 'Color',
                    'red': 'Red',
                    'orange': 'Orange',
                    'green': 'Green',
                    'blue': 'Blue',
                    'size': 'Size',
                    'lineWidth': 'Line Width',
                    'thin': 'Thin',
                    'normal': 'Normal',
                    'thick': 'Thick',
                    'shape': 'Shape',
                    'rectangle': 'Rectangle',
                    'circle': 'Circle',
                    'arrow': 'Arrow',
                    'fill': 'Fill',
                    'fillNone': 'Border Only',
                    'fillSolid': 'Solid Fill',
                    'fillBlur': 'Blur Effect',
                    'fillMosaic': 'Mosaic',
                    'emojiType': 'Emoji Type',
                    'cropStyle': 'Crop Style',
                    'cropBasic': 'Basic Crop',
                    'cropShadow': 'Shadow Effect',
                    'cropRounded': 'Rounded Corners',
                    'cropTorn': 'Torn Paper',
                    'cropCurtain': 'Theater Curtain',
                    'cropControls': 'Crop Controls',
                    'applyCrop': 'Apply Crop',
                    'cancelCrop': 'Cancel Crop',
                    'layers': 'Layers',
                    'backgroundLayer': 'Background Image',
                    'clearAllLayers': 'Clear All Layers',
                    'cropInstruction': 'Drag to select crop area',
                    'undo': 'Undo',
                    'redo': 'Redo',
                    'save': 'Save',
                    'toggleTheme': 'Toggle Theme',
                    'language': 'Language',
                    'releaseNotes': 'Release Notes',
                    'codeLineRemover': 'Code Line Remover',
                    'legacyVersion': 'Legacy Version',
                    'chromeExtension': 'Chrome Extension',
                    'editImage': 'Edit Image',
                    'imageSize': 'Image Size:',
                    'autoResize': 'Auto Resize (Default)',
                    'originalSize': 'Original',
                    'width300': 'Width 300',
                    'width600': 'Width 600',
                    'width900': 'Width 900',
                    'scale30': 'Scale 30%',
                    'scale50': 'Scale 50%',
                    'scale70': 'Scale 70%',
                    'uploadImagePrompt': 'How to use AnnotateShot\n1. Load an image that needs numbers, shapes, or text annotations. Clipboard images are supported.\n2. Click anywhere on the image.\n3. When you need to save, click the Save button to download to your local PC. You can also right-click the image and copy it.',
                    'mobileUploadImagePrompt': 'AnnotateShot Mobile Guide\n1. Tap 🖼️ button to load image from gallery\n2. Number mode: Touch screen to add sequential numbers\n3. Emoji mode: Tap 😀 button to select, then touch to add\n4. Text mode: Touch screen to open text input dialog\n5. Drag to move: All annotations can be dragged to new positions\n6. Tap 💾 button (top-right) to save your annotated image',
                    'blankCanvasPrompt': 'Blank Canvas Mode (Multi Image)\n1. Select a background color.\n2. Upload multiple images to compose as layers.\n3. Drag each image to adjust its position.',
                    'imageLoaded': 'Image loaded: {width} x {height}',
                    'imageLayerAdded': 'Image layer {layerNumber} added: {width} x {height}',
                    'mouseMovePrompt': 'Move your mouse',
                    'statusCoordinates': 'Coordinates: ({x}, {y})',
                    'statusOutsideCanvas': 'Outside canvas area',
                    'statusWaiting': 'Waiting',
                    'statusModeChanged': 'Mode changed: {modeName}',
                    'statusEmojiSelected': 'Emoji selected: {emoji}',
                    'statusShapeSelected': 'Shape selected: {shapeName}',
                    'statusColorChanged': 'Color changed: {colorName}',
                    'statusImageSaved': 'Image saved',
                    'statusUndo': 'Action undone',
                    'statusAdded': '{modeName} added at: ({x}, {y})',
                    'cropTooSmall': 'Crop area is too small (minimum 10×10 pixels)',
                    'cropSelected': 'Crop area selected. Choose a style and click Apply.',
                    'cropApplied': 'Crop has been applied',
                    'cropCancelled': 'Crop has been cancelled',
                    'enterText': 'Enter text',
                    'textAdded': 'Text "{text}" added at: ({x}, {y})',
                    'emojiAdded': 'Emoji {emoji} added at: ({x}, {y})'
                }
            };

            const lang = getLanguage();
            let text = translations[lang]?.[key] || translations['en']?.[key] || key;
            
            // Replace parameters
            Object.keys(params).forEach(param => {
                text = text.replace(`{${param}}`, params[param]);
            });
            
            return text;
        }

        function updateUILanguage() {
            const lang = getLanguage();
            document.documentElement.lang = lang;
            
            document.querySelectorAll('[data-lang-key]').forEach(element => {
                const key = element.dataset.langKey;
                const translatedText = translate(key);
                
                // Handle special cases like prompt text with line breaks
                if (key === 'uploadImagePrompt') {
                    // 모바일 기기에서는 모바일용 텍스트 사용
                    const isMobile = document.body.classList.contains('mobile-device');
                    const actualKey = isMobile ? 'mobileUploadImagePrompt' : 'uploadImagePrompt';
                    const actualText = translate(actualKey);
                    element.innerHTML = actualText.replace(/\n/g, '<br>');
                } else {
                    element.textContent = translatedText;
                }
            });

            // Update language selector to reflect current language
            const languageSelector = document.getElementById('languageSelector');
            if (languageSelector) {
                languageSelector.value = lang;
            }
        }

        function getModeDisplayName(mode) {
            return translate(mode + 'Mode');
        }

        function getShapeDisplayName(shape) {
            return translate(shape);
        }

        function getColorDisplayName(color) {
            const colorMap = {
                '#FF0000': 'red',
                '#FF8000': 'orange',
                '#00FF00': 'green',
                '#0000FF': 'blue'
            };
            return translate(colorMap[color.toUpperCase()] || color);
        }

        // Initialize all functionality when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            initializeTheme();
            initializeSidebar();
            initializeLayerSidebar();
            initializeModeControls();
            initializeStatusLogging();
            updateCanvasContainer();
            
            // Initialize language selector
            const languageSelector = document.getElementById('languageSelector');
            languageSelector.addEventListener('change', (e) => {
                setLanguage(e.target.value);
            });

            // Set initial language
            updateUILanguage();
            
            // Ensure initial mode controls are properly displayed
            setTimeout(() => {
                updateControlsVisibility();
            }, 100);
            
            // Watch for canvas changes
            const canvas = document.getElementById('imageCanvas');
            const observer = new MutationObserver(updateCanvasContainer);
            observer.observe(canvas, { attributes: true, attributeFilter: ['width', 'height'] });
        });

        // 모바일 UI는 별도 mobile.js에서 처리됨
    </script>

    <!-- 모바일 전용 UI 컴포넌트들 -->
    <div class="mobile-only" style="display: none;">
        <!-- 플로팅 액션 버튼들 -->
        <div class="floating-action-buttons">
            <button class="fab" id="fabImage" title="이미지 업로드">
                <span class="material-icons">add_photo_alternate</span>
            </button>
            <button class="fab save" id="fabSave" title="저장">
                <span class="material-icons">save</span>
            </button>
            <button class="fab undo" id="fabUndo" title="되돌리기">
                <span class="material-icons">undo</span>
            </button>
            <button class="fab" id="fabSettings" title="스타일 설정">
                <span class="material-icons">palette</span>
            </button>
        </div>
        
        <!-- 모바일 전용 숨겨진 파일 입력 -->
        <input type="file" id="mobileImageInput" accept="image/*" capture="environment" style="display: none;">
    </div>

        <!-- 이모지 선택 레이어 (팝업) -->
        <div class="emoji-layer" id="emojiLayer" style="display: none;">
            <div class="emoji-layer-header">
                <h3>이모지 선택</h3>
                <button class="emoji-close-btn" id="emojiCloseBtn">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="emoji-layer-grid">
                <button class="emoji-layer-btn" data-emoji="😀">😀</button>
                <button class="emoji-layer-btn" data-emoji="😍">😍</button>
                <button class="emoji-layer-btn" data-emoji="🤔">🤔</button>
                <button class="emoji-layer-btn" data-emoji="👍">👍</button>
                <button class="emoji-layer-btn" data-emoji="👎">👎</button>
                <button class="emoji-layer-btn" data-emoji="❤️">❤️</button>
                <button class="emoji-layer-btn" data-emoji="⭐">⭐</button>
                <button class="emoji-layer-btn" data-emoji="🔥">🔥</button>
                <button class="emoji-layer-btn" data-emoji="💯">💯</button>
                <button class="emoji-layer-btn" data-emoji="✅">✅</button>
                <button class="emoji-layer-btn" data-emoji="❌">❌</button>
                <button class="emoji-layer-btn" data-emoji="⚠️">⚠️</button>
            </div>
        </div>

        <!-- 모바일 하단 툴바 -->
        <div class="mobile-toolbar">
            <button class="toolbar-button" data-mode="number">
                <span class="material-icons">format_list_numbered</span>
                <span>숫자</span>
            </button>
            <button class="toolbar-button" data-mode="text">
                <span class="material-icons">text_fields</span>
                <span>텍스트</span>
            </button>
            <button class="toolbar-button" data-mode="emoji">
                <span class="material-icons">sentiment_satisfied</span>
                <span>이모지</span>
            </button>
        </div>

        <!-- 모바일 모드 선택 패널 -->
        <div class="mobile-mode-panel" id="mobileModePanel">
            <h3 style="margin-top: 0; text-align: center;">편집 모드 선택</h3>
            <div class="mode-grid">
                <div class="mode-card" onclick="selectMobileMode('number')">
                    <span class="material-icons">format_list_numbered</span>
                    <div class="mode-name">숫자 모드</div>
                </div>
                <div class="mode-card" onclick="selectMobileMode('shape')">
                    <span class="material-icons">crop_square</span>
                    <div class="mode-name">도형 모드</div>
                </div>
                <div class="mode-card" onclick="selectMobileMode('text')">
                    <span class="material-icons">text_fields</span>
                    <div class="mode-name">텍스트 모드</div>
                </div>
                <div class="mode-card" onclick="selectMobileMode('emoji')">
                    <span class="material-icons">sentiment_satisfied</span>
                    <div class="mode-name">이모지 모드</div>
                </div>
            </div>
            <button onclick="hideMobileModePanel()" style="margin-top: 1.5rem; width: 100%; padding: 1rem; background-color: var(--muted); border: none; border-radius: 8px; color: var(--foreground); font-size: 1rem;">닫기</button>
        </div>
        
        <!-- 모바일 설정 패널 -->
        <div class="mobile-settings-panel" id="mobileSettingsPanel">
            <h3 style="margin-top: 0; text-align: center; color: var(--foreground);">스타일 설정</h3>
            
            <!-- 색상 선택 -->
            <div class="setting-section">
                <h4 style="margin: 0 0 1rem 0; color: var(--foreground); font-size: 1rem;">색상</h4>
                <div class="mobile-color-grid">
                    <button class="mobile-color-btn" data-color="#FF0000" style="background: #FF0000;" title="빨간색"></button>
                    <button class="mobile-color-btn" data-color="#FF8000" style="background: #FF8000;" title="주황색"></button>
                    <button class="mobile-color-btn" data-color="#00FF00" style="background: #00FF00;" title="녹색"></button>
                    <button class="mobile-color-btn" data-color="#0000FF" style="background: #0000FF;" title="파란색"></button>
                    <button class="mobile-color-btn" data-color="#FF00FF" style="background: #FF00FF;" title="자주색"></button>
                    <button class="mobile-color-btn" data-color="#00FFFF" style="background: #00FFFF;" title="청록색"></button>
                    <button class="mobile-color-btn" data-color="#FFFF00" style="background: #FFFF00;" title="노란색"></button>
                    <button class="mobile-color-btn" data-color="#000000" style="background: #000000;" title="검은색"></button>
                </div>
            </div>
            
            <!-- 크기 조정 -->
            <div class="setting-section">
                <h4 style="margin: 0 0 1rem 0; color: var(--foreground); font-size: 1rem;">크기</h4>
                <div class="mobile-size-slider">
                    <input type="range" id="mobileSizeSlider" min="10" max="70" step="5" value="20" style="width: 100%;">
                    <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--muted-foreground); margin-top: 0.5rem;">
                        <span>10px</span>
                        <span id="mobileSizeValue">20px</span>
                        <span>70px</span>
                    </div>
                </div>
            </div>
            
            <!-- 이모지 선택 (이모지 모드일 때만 표시) -->
            <div class="setting-section" id="emojiSection" style="display: none;">
                <h4 style="margin: 0 0 1rem 0; color: var(--foreground); font-size: 1rem;">이모지 선택</h4>
                <div class="mobile-emoji-grid">
                    <button class="mobile-emoji-btn" data-emoji="😀">😀</button>
                    <button class="mobile-emoji-btn" data-emoji="😍">😍</button>
                    <button class="mobile-emoji-btn" data-emoji="🤔">🤔</button>
                    <button class="mobile-emoji-btn" data-emoji="👍">👍</button>
                    <button class="mobile-emoji-btn" data-emoji="👎">👎</button>
                    <button class="mobile-emoji-btn" data-emoji="❤️">❤️</button>
                    <button class="mobile-emoji-btn" data-emoji="⭐">⭐</button>
                    <button class="mobile-emoji-btn" data-emoji="🔥">🔥</button>
                    <button class="mobile-emoji-btn" data-emoji="💯">💯</button>
                    <button class="mobile-emoji-btn" data-emoji="✅">✅</button>
                    <button class="mobile-emoji-btn" data-emoji="❌">❌</button>
                    <button class="mobile-emoji-btn" data-emoji="⚠️">⚠️</button>
                </div>
            </div>
            
            <!-- 도형 채우기 옵션 (도형 모드일 때만 표시) -->
            <div class="setting-section" id="shapeSection" style="display: none;">
                <h4 style="margin: 0 0 1rem 0; color: var(--foreground); font-size: 1rem;">채우기 옵션</h4>
                <div class="mobile-fill-options">
                    <button class="mobile-fill-btn active" data-fill="none">테두리만</button>
                    <button class="mobile-fill-btn" data-fill="solid">채우기</button>
                    <button class="mobile-fill-btn" data-fill="blur">흐림</button>
                    <button class="mobile-fill-btn" data-fill="mosaic">모자이크</button>
                </div>
            </div>
            
            <button onclick="hideMobileSettingsPanel()" style="margin-top: 1.5rem; width: 100%; padding: 1rem; background-color: var(--muted); border: none; border-radius: 8px; color: var(--foreground); font-size: 1rem;">닫기</button>
        </div>
        
        <!-- 모바일 디버그 로그 패널 -->
        <div class="mobile-debug-panel" id="mobileDebugPanel" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h3 style="margin: 0; color: #00FF00; font-size: 1rem;">🐛 Debug Log</h3>
                <div>
                    <button onclick="copyMobileDebugLog()" style="padding: 0.5rem; background: #00AA00; color: white; border: none; border-radius: 4px; margin-right: 0.5rem; font-size: 0.8rem;">Copy</button>
                    <button onclick="clearMobileDebugLog()" style="padding: 0.5rem; background: #FF4444; color: white; border: none; border-radius: 4px; margin-right: 0.5rem; font-size: 0.8rem;">Clear</button>
                    <button onclick="hideMobileDebugPanel()" style="padding: 0.5rem; background: #666; color: white; border: none; border-radius: 4px; font-size: 0.8rem;">Hide</button>
                </div>
            </div>
            <div id="mobileDebugLog" style="font-family: monospace; font-size: 0.8rem; color: #00FF00; background: #000; padding: 1rem; border-radius: 8px; max-height: 300px; overflow-y: auto; white-space: pre-wrap; word-break: break-all;"></div>
        </div>
    </div>

    <!-- Mobile UI Module - 모든 DOM이 로드된 후 실행 -->
    <script src="src/mobile.js"></script>
    
    <!-- 모바일 디버그 스크립트 -->
    <script>
        function copyMobileDebugLog() {
            const logDiv = document.getElementById('mobileDebugLog');
            if (logDiv && logDiv.textContent) {
                try {
                    // 모바일에서 안전한 복사 방법
                    const textArea = document.createElement('textarea');
                    textArea.value = logDiv.textContent;
                    textArea.style.position = 'fixed';
                    textArea.style.left = '-9999px';
                    textArea.style.top = '-9999px';
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    
                    const successful = document.execCommand('copy');
                    document.body.removeChild(textArea);
                    
                    if (successful) {
                        alert('디버그 로그가 클립보드에 복사되었습니다!');
                    } else {
                        alert('복사 실패 - 수동으로 선택해서 복사하세요');
                    }
                } catch (err) {
                    alert('복사 기능 사용 불가 - 로그를 수동으로 복사하세요');
                }
            }
        }
        
        function clearMobileDebugLog() {
            const logDiv = document.getElementById('mobileDebugLog');
            if (logDiv) {
                logDiv.textContent = '';
            }
        }
        
        function hideMobileDebugPanel() {
            const panel = document.getElementById('mobileDebugPanel');
            if (panel) {
                panel.style.display = 'none';
            }
        }
    </script>
    
    <!-- 디버그 스크립트 -->
    <script>
        // iPhone Safari 디버그 정보 출력
        setTimeout(() => {
            console.log('🔍 iPhone Safari 디버그 정보:');
            console.log('User Agent:', navigator.userAgent);
            console.log('Body 클래스:', document.body.className);
            console.log('모바일 UI 요소 표시:', document.querySelector('.mobile-only')?.style.display);
            console.log('플로팅 버튼 존재:', !!document.getElementById('fabImage'));
            console.log('============================');
        }, 2000);
    </script>

</body>
</html>