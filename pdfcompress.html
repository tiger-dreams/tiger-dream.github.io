<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-adsense-account" content="ca-pub-3945001668113003">
    <title>PDF Compress - ë¬´ë£Œ PDF íŒŒì¼ ì••ì¶• ë„êµ¬</title>
    <meta name="description" content="PDF Compress - PDF íŒŒì¼ì„ ë¹ ë¥´ê³  ì•ˆì „í•˜ê²Œ ì••ì¶•í•˜ì„¸ìš”. ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ ì²˜ë¦¬ë˜ì–´ ê°œì¸ì •ë³´ ë³´í˜¸ê°€ ë³´ì¥ë©ë‹ˆë‹¤.">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <style>
        :root {
            /* Light theme colors */
            --background: #ffffff;
            --foreground: #0f172a;
            --card: #ffffff;
            --card-foreground: #0f172a;
            --primary: #3b82f6;
            --primary-foreground: #ffffff;
            --secondary: #f1f5f9;
            --secondary-foreground: #475569;
            --muted: #f8fafc;
            --muted-foreground: #64748b;
            --accent: #f1f5f9;
            --accent-foreground: #0f172a;
            --destructive: #ef4444;
            --destructive-foreground: #ffffff;
            --border: #e2e8f0;
            --input: #e2e8f0;
            --ring: #3b82f6;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --radius: 0.5rem;
        }

        [data-theme="dark"] {
            /* Dark theme colors */
            --background: #0f172a;
            --foreground: #f8fafc;
            --card: #1e293b;
            --card-foreground: #f8fafc;
            --primary: #3b82f6;
            --primary-foreground: #ffffff;
            --secondary: #1e293b;
            --secondary-foreground: #94a3b8;
            --muted: #1e293b;
            --muted-foreground: #64748b;
            --accent: #1e293b;
            --accent-foreground: #f8fafc;
            --destructive: #ef4444;
            --destructive-foreground: #ffffff;
            --border: #334155;
            --input: #334155;
            --ring: #3b82f6;
            --success-color: #10b981;
            --warning-color: #f59e0b;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background-color: var(--background);
            color: var(--foreground);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--primary), #6366f1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1.1rem;
            color: var(--muted-foreground);
        }

        .main-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 2rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            flex: 1;
        }

        .upload-area {
            border: 2px dashed var(--border);
            border-radius: var(--radius);
            padding: 3rem 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 2rem;
        }

        .upload-area:hover {
            border-color: var(--primary);
            background-color: var(--muted);
        }

        .upload-area.drag-over {
            border-color: var(--primary);
            background-color: var(--muted);
        }

        .upload-icon {
            font-size: 3rem;
            color: var(--muted-foreground);
            margin-bottom: 1rem;
        }

        .upload-text {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            color: var(--foreground);
        }

        .upload-subtext {
            font-size: 0.9rem;
            color: var(--muted-foreground);
        }

        .file-input {
            display: none;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius);
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
            cursor: pointer;
            border: 1px solid var(--border);
            background-color: var(--background);
            color: var(--foreground);
            text-decoration: none;
            gap: 0.5rem;
        }

        .btn:hover {
            background-color: var(--muted);
        }

        .btn.primary {
            background-color: var(--primary);
            color: var(--primary-foreground);
            border-color: var(--primary);
        }

        .btn.primary:hover {
            opacity: 0.9;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .progress-container {
            margin: 2rem 0;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: var(--muted);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--primary);
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .progress-text {
            text-align: center;
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: var(--muted-foreground);
        }

        .file-info {
            background: var(--muted);
            border-radius: var(--radius);
            padding: 1rem;
            margin: 1rem 0;
            display: none;
        }

        .file-info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .file-info-item:last-child {
            margin-bottom: 0;
        }

        .file-info-label {
            font-weight: 500;
        }

        .file-info-value {
            color: var(--muted-foreground);
        }

        .compression-options {
            margin: 2rem 0;
            display: none;
        }

        .options-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .option-group {
            margin-bottom: 1rem;
        }

        .option-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .option-select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background-color: var(--background);
            color: var(--foreground);
        }

        .result-area {
            margin-top: 2rem;
            display: none;
        }

        .result-card {
            background: var(--success-color);
            color: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            text-align: center;
        }

        .result-icon {
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .result-text {
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }

        .compression-stats {
            display: flex;
            justify-content: space-around;
            margin: 1rem 0;
            font-size: 0.9rem;
        }

        .compression-stats div {
            text-align: center;
        }

        .compression-stats strong {
            display: block;
            font-size: 1.2rem;
            margin-bottom: 0.25rem;
        }

        .footer {
            text-align: center;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
        }

        .footer a {
            color: var(--primary);
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        .language-selector {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 8px 12px;
            font-size: 0.8rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .language-selector select {
            background: transparent;
            border: none;
            color: var(--foreground);
            font-size: 0.8rem;
            cursor: pointer;
        }

        .message {
            padding: 1rem;
            border-radius: var(--radius);
            margin: 1rem 0;
            display: none;
        }

        .message.error {
            background-color: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--destructive);
            color: var(--destructive);
        }

        .message.success {
            background-color: rgba(16, 185, 129, 0.1);
            border: 1px solid var(--success-color);
            color: var(--success-color);
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .header h1 {
                font-size: 2rem;
            }

            .main-card {
                padding: 1.5rem;
            }

            .upload-area {
                padding: 2rem 1rem;
            }

            .compression-stats {
                flex-direction: column;
                gap: 1rem;
            }

            .language-selector {
                bottom: 15px;
                right: 15px;
                padding: 6px 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>PDF Compress</h1>
            <p data-lang-key="subtitle">ë¬´ë£Œ PDF íŒŒì¼ ì••ì¶• ë„êµ¬</p>
        </div>

        <div class="main-card">
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">
                    <span class="material-icons">cloud_upload</span>
                </div>
                <div class="upload-text" data-lang-key="uploadText">PDF íŒŒì¼ì„ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”</div>
                <div class="upload-subtext" data-lang-key="uploadSubtext">ìµœëŒ€ 50MBê¹Œì§€ ì§€ì›ë©ë‹ˆë‹¤</div>
            </div>

            <input type="file" id="fileInput" class="file-input" accept=".pdf" />

            <div class="file-info" id="fileInfo">
                <div class="file-info-item">
                    <span class="file-info-label" data-lang-key="fileName">íŒŒì¼ëª…:</span>
                    <span class="file-info-value" id="fileNameValue"></span>
                </div>
                <div class="file-info-item">
                    <span class="file-info-label" data-lang-key="fileSize">íŒŒì¼ í¬ê¸°:</span>
                    <span class="file-info-value" id="fileSizeValue"></span>
                </div>
                <div class="file-info-item">
                    <span class="file-info-label" data-lang-key="pageCount">í˜ì´ì§€ ìˆ˜:</span>
                    <span class="file-info-value" id="pageCountValue"></span>
                </div>
            </div>

            <div class="compression-options" id="compressionOptions">
                <div class="options-title" data-lang-key="compressionOptions">ì••ì¶• ì˜µì…˜</div>
                <div class="option-group">
                    <label class="option-label" data-lang-key="compressionLevel">ì••ì¶• ëª¨ë“œ:</label>
                    <select class="option-select" id="compressionLevel">
                        <option value="low" data-lang-key="lowCompression">ë‚®ìŒ (150 DPI, ë†’ì€ í’ˆì§ˆ)</option>
                        <option value="medium" selected data-lang-key="mediumCompression">ë³´í†µ (120 DPI, ê· í˜•)</option>
                        <option value="high" data-lang-key="highCompression">ë†’ìŒ (96 DPI, ì‘ì€ í¬ê¸°)</option>
                        <option value="extreme" data-lang-key="extremeCompression">ìµœê³  (72 DPI, ìµœì†Œ í¬ê¸°)</option>
                        <option value="smart" data-lang-key="smartCompression">ğŸ¯ ìŠ¤ë§ˆíŠ¸ ì••ì¶• (ëª©í‘œ í¬ê¸°ì— ë§ì¶¤)</option>
                    </select>
                </div>
                <div class="option-group" id="targetSizeGroup" style="display: none;">
                    <label class="option-label" data-lang-key="targetSize">ëª©í‘œ íŒŒì¼ í¬ê¸°:</label>
                    <div style="display: flex; gap: 0.5rem; align-items: center;">
                        <select class="option-select" id="targetSizePreset" style="flex: 1;">
                            <option value="" data-lang-key="customSize">ì§ì ‘ ì…ë ¥</option>
                            <option value="2048" data-lang-key="preset2mb">2MB (ì´ë©”ì¼ ì²¨ë¶€íŒŒì¼)</option>
                            <option value="5120" data-lang-key="preset5mb">5MB (ì¼ë°˜ì ì¸ ì œí•œ)</option>
                            <option value="10240" data-lang-key="preset10mb">10MB (ëŒ€ìš©ëŸ‰ í—ˆìš©)</option>
                        </select>
                        <div style="display: flex; align-items: center; gap: 0.25rem;">
                            <input type="number" id="customTargetSize" min="0.1" max="100" step="0.1" 
                                   placeholder="2.0" style="width: 80px; padding: 0.5rem; border: 1px solid var(--border); border-radius: var(--radius);">
                            <span style="font-size: 0.9rem; color: var(--muted-foreground);">MB</span>
                        </div>
                    </div>
                    <div style="font-size: 0.8rem; color: var(--muted-foreground); margin-top: 0.5rem;" data-lang-key="smartCompressionNote">
                        ìŠ¤ë§ˆíŠ¸ ì••ì¶•ì€ ëª©í‘œ í¬ê¸°ì— ë§ì¶° ìë™ìœ¼ë¡œ ìµœì  í’ˆì§ˆì„ ì°¾ìŠµë‹ˆë‹¤.
                    </div>
                </div>
                <div class="option-group">
                    <label class="option-label" data-lang-key="optimizeOptions">ìµœì í™” ì˜µì…˜:</label>
                    <div style="display: flex; flex-wrap: wrap; gap: 1rem; margin-top: 0.5rem;">
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox" id="removeMetadata" checked>
                            <span data-lang-key="removeMetadata">ë©”íƒ€ë°ì´í„° ì œê±°</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox" id="optimizeImages" checked>
                            <span data-lang-key="optimizeImages">ì´ë¯¸ì§€ ìµœì í™”</span>
                        </label>
                    </div>
                </div>
                <button class="btn primary" id="compressBtn" data-lang-key="compressBtn">PDF ì••ì¶•í•˜ê¸°</button>
            </div>

            <div class="progress-container" id="progressContainer">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">ì••ì¶• ì¤‘...</div>
            </div>

            <div class="message" id="messageArea"></div>

            <div class="result-area" id="resultArea">
                <div class="result-card">
                    <div class="result-icon">
                        <span class="material-icons">check_circle</span>
                    </div>
                    <div class="result-text" data-lang-key="compressionComplete">PDF ì••ì¶•ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</div>
                    <div class="compression-stats" id="compressionStats">
                        <div>
                            <strong id="originalSize">0 MB</strong>
                            <span data-lang-key="originalSize">ì›ë³¸ í¬ê¸°</span>
                        </div>
                        <div>
                            <strong id="compressedSize">0 MB</strong>
                            <span data-lang-key="compressedSize">ì••ì¶• í›„ í¬ê¸°</span>
                        </div>
                        <div>
                            <strong id="compressionRatio">0%</strong>
                            <span data-lang-key="compressionRatio">ì••ì¶•ë¥ </span>
                        </div>
                    </div>
                    <button class="btn" id="downloadBtn" data-lang-key="downloadBtn">ì••ì¶•ëœ PDF ë‹¤ìš´ë¡œë“œ</button>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>
                <a href="index.html" data-lang-key="backToMain">â† AnnotateShotìœ¼ë¡œ ëŒì•„ê°€ê¸°</a> |
                <a href="delcodelinenum.html" data-lang-key="otherTools">ë‹¤ë¥¸ ë„êµ¬ë“¤</a>
            </p>
            <p style="margin-top: 1rem; color: var(--muted-foreground);">
                <span data-lang-key="footerText">ëª¨ë“  ì²˜ë¦¬ëŠ” ë¸Œë¼ìš°ì €ì—ì„œ ì§„í–‰ë˜ì–´ íŒŒì¼ì´ ì„œë²„ë¡œ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</span>
            </p>
        </div>
    </div>

    <!-- Language Selector -->
    <div class="language-selector">
        <select id="languageSelector" aria-label="Select language">
            <option value="ko">í•œêµ­ì–´</option>
            <option value="en">English</option>
        </select>
    </div>

    <!-- PDF-lib CDN -->
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <!-- PDF.js for better PDF processing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    
    <script>
        // PDF.js ì„¤ì •
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        // ì–¸ì–´ ê´€ë¦¬
        const languages = {
            ko: {
                subtitle: "ë¬´ë£Œ PDF íŒŒì¼ ì••ì¶• ë„êµ¬",
                uploadText: "PDF íŒŒì¼ì„ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”",
                uploadSubtext: "ìµœëŒ€ 50MBê¹Œì§€ ì§€ì›ë©ë‹ˆë‹¤",
                fileName: "íŒŒì¼ëª…:",
                fileSize: "íŒŒì¼ í¬ê¸°:",
                pageCount: "í˜ì´ì§€ ìˆ˜:",
                compressionOptions: "ì••ì¶• ì˜µì…˜",
                compressionLevel: "ì••ì¶• ìˆ˜ì¤€:",
                lowCompression: "ë‚®ìŒ (150 DPI, ë†’ì€ í’ˆì§ˆ)",
                mediumCompression: "ë³´í†µ (120 DPI, ê· í˜•)",
                highCompression: "ë†’ìŒ (96 DPI, ì‘ì€ í¬ê¸°)",
                extremeCompression: "ìµœê³  (72 DPI, ìµœì†Œ í¬ê¸°)",
                smartCompression: "ğŸ¯ ìŠ¤ë§ˆíŠ¸ ì••ì¶• (ëª©í‘œ í¬ê¸°ì— ë§ì¶¤)",
                targetSize: "ëª©í‘œ íŒŒì¼ í¬ê¸°:",
                customSize: "ì§ì ‘ ì…ë ¥",
                preset2mb: "2MB (ì´ë©”ì¼ ì²¨ë¶€íŒŒì¼)",
                preset5mb: "5MB (ì¼ë°˜ì ì¸ ì œí•œ)",
                preset10mb: "10MB (ëŒ€ìš©ëŸ‰ í—ˆìš©)",
                smartCompressionNote: "ìŠ¤ë§ˆíŠ¸ ì••ì¶•ì€ ëª©í‘œ í¬ê¸°ì— ë§ì¶° ìë™ìœ¼ë¡œ ìµœì  í’ˆì§ˆì„ ì°¾ìŠµë‹ˆë‹¤.",
                optimizeOptions: "ìµœì í™” ì˜µì…˜:",
                removeMetadata: "ë©”íƒ€ë°ì´í„° ì œê±°",
                optimizeImages: "ì´ë¯¸ì§€ ìµœì í™”",
                compressBtn: "PDF ì••ì¶•í•˜ê¸°",
                compressionComplete: "PDF ì••ì¶•ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!",
                originalSize: "ì›ë³¸ í¬ê¸°",
                compressedSize: "ì••ì¶• í›„ í¬ê¸°",
                compressionRatio: "ì••ì¶•ë¥ ",
                downloadBtn: "ì••ì¶•ëœ PDF ë‹¤ìš´ë¡œë“œ",
                backToMain: "â† AnnotateShotìœ¼ë¡œ ëŒì•„ê°€ê¸°",
                otherTools: "ë‹¤ë¥¸ ë„êµ¬ë“¤",
                footerText: "ëª¨ë“  ì²˜ë¦¬ëŠ” ë¸Œë¼ìš°ì €ì—ì„œ ì§„í–‰ë˜ì–´ íŒŒì¼ì´ ì„œë²„ë¡œ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.",
                processing: "ì••ì¶• ì¤‘...",
                errorInvalidFile: "ì˜¬ë°”ë¥¸ PDF íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.",
                errorFileTooLarge: "íŒŒì¼ í¬ê¸°ê°€ ë„ˆë¬´ í½ë‹ˆë‹¤. 50MB ì´í•˜ì˜ íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.",
                errorProcessing: "PDF ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."
            },
            en: {
                subtitle: "Free PDF File Compression Tool",
                uploadText: "Drag and drop your PDF file here or click to select",
                uploadSubtext: "Maximum file size: 50MB",
                fileName: "File name:",
                fileSize: "File size:",
                pageCount: "Page count:",
                compressionOptions: "Compression Options",
                compressionLevel: "Compression level:",
                lowCompression: "Low (150 DPI, High quality)",
                mediumCompression: "Medium (120 DPI, Balanced)",
                highCompression: "High (96 DPI, Small size)",
                extremeCompression: "Extreme (72 DPI, Smallest size)",
                smartCompression: "ğŸ¯ Smart Compression (Target size)",
                targetSize: "Target file size:",
                customSize: "Custom size",
                preset2mb: "2MB (Email attachment)",
                preset5mb: "5MB (Common limit)",
                preset10mb: "10MB (Large files)",
                smartCompressionNote: "Smart compression automatically finds optimal quality for your target size.",
                optimizeOptions: "Optimization Options:",
                removeMetadata: "Remove metadata",
                optimizeImages: "Optimize images",
                compressBtn: "Compress PDF",
                compressionComplete: "PDF compression completed!",
                originalSize: "Original Size",
                compressedSize: "Compressed Size",
                compressionRatio: "Compression Ratio",
                downloadBtn: "Download Compressed PDF",
                backToMain: "â† Back to AnnotateShot",
                otherTools: "Other Tools",
                footerText: "All processing is done in your browser. No files are uploaded to servers.",
                processing: "Compressing...",
                errorInvalidFile: "Please select a valid PDF file.",
                errorFileTooLarge: "File is too large. Please select a file under 50MB.",
                errorProcessing: "An error occurred while processing the PDF."
            }
        };

        // í˜„ì¬ ì–¸ì–´ ì„¤ì •
        let currentLanguage = 'ko';

        // ì–¸ì–´ ì ìš© í•¨ìˆ˜
        function applyLanguage() {
            const elements = document.querySelectorAll('[data-lang-key]');
            elements.forEach(element => {
                const key = element.getAttribute('data-lang-key');
                if (languages[currentLanguage] && languages[currentLanguage][key]) {
                    if (element.tagName === 'INPUT' && element.type === 'text') {
                        element.placeholder = languages[currentLanguage][key];
                    } else {
                        element.textContent = languages[currentLanguage][key];
                    }
                }
            });
        }

        // ì–¸ì–´ ì„ íƒê¸° ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            const langSelect = document.getElementById('languageSelector');
            langSelect.value = currentLanguage;
            langSelect.addEventListener('change', (e) => {
                currentLanguage = e.target.value;
                applyLanguage();
            });
            applyLanguage();
        });

        // PDF ì••ì¶• ê¸°ëŠ¥
        class PDFCompressor {
            constructor() {
                this.currentFile = null;
                this.initializeElements();
                this.bindEvents();
            }

            initializeElements() {
                this.uploadArea = document.getElementById('uploadArea');
                this.fileInput = document.getElementById('fileInput');
                this.fileInfo = document.getElementById('fileInfo');
                this.compressionOptions = document.getElementById('compressionOptions');
                this.progressContainer = document.getElementById('progressContainer');
                this.resultArea = document.getElementById('resultArea');
                this.messageArea = document.getElementById('messageArea');
                this.compressBtn = document.getElementById('compressBtn');
                this.downloadBtn = document.getElementById('downloadBtn');
                this.progressFill = document.getElementById('progressFill');
                this.progressText = document.getElementById('progressText');
            }

            bindEvents() {
                this.uploadArea.addEventListener('click', () => this.fileInput.click());
                this.uploadArea.addEventListener('dragover', this.handleDragOver.bind(this));
                this.uploadArea.addEventListener('dragleave', this.handleDragLeave.bind(this));
                this.uploadArea.addEventListener('drop', this.handleDrop.bind(this));
                this.fileInput.addEventListener('change', this.handleFileSelect.bind(this));
                this.compressBtn.addEventListener('click', this.compressPDF.bind(this));
                
                // ì••ì¶• ëª¨ë“œ ë³€ê²½ ì´ë²¤íŠ¸
                document.getElementById('compressionLevel').addEventListener('change', this.handleCompressionModeChange.bind(this));
                
                // ëª©í‘œ í¬ê¸° í”„ë¦¬ì…‹ ë³€ê²½ ì´ë²¤íŠ¸
                document.getElementById('targetSizePreset').addEventListener('change', this.handleTargetSizePresetChange.bind(this));
            }

            handleCompressionModeChange(e) {
                const targetSizeGroup = document.getElementById('targetSizeGroup');
                if (e.target.value === 'smart') {
                    targetSizeGroup.style.display = 'block';
                    // ê¸°ë³¸ê°’ìœ¼ë¡œ 2MB ì„¤ì •
                    document.getElementById('targetSizePreset').value = '2048';
                    document.getElementById('customTargetSize').value = '2.0';
                } else {
                    targetSizeGroup.style.display = 'none';
                }
            }

            handleTargetSizePresetChange(e) {
                const customInput = document.getElementById('customTargetSize');
                if (e.target.value) {
                    customInput.value = (parseInt(e.target.value) / 1024).toFixed(1);
                } else {
                    customInput.focus();
                }
            }

            handleDragOver(e) {
                e.preventDefault();
                this.uploadArea.classList.add('drag-over');
            }

            handleDragLeave(e) {
                e.preventDefault();
                this.uploadArea.classList.remove('drag-over');
            }

            handleDrop(e) {
                e.preventDefault();
                this.uploadArea.classList.remove('drag-over');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    this.processFile(files[0]);
                }
            }

            handleFileSelect(e) {
                const file = e.target.files[0];
                if (file) {
                    this.processFile(file);
                }
            }

            processFile(file) {
                if (file.type !== 'application/pdf') {
                    this.showMessage(languages[currentLanguage].errorInvalidFile, 'error');
                    return;
                }

                if (file.size > 50 * 1024 * 1024) { // 50MB
                    this.showMessage(languages[currentLanguage].errorFileTooLarge, 'error');
                    return;
                }

                this.currentFile = file;
                this.displayFileInfo(file);
            }

            async displayFileInfo(file) {
                try {
                    const arrayBuffer = await file.arrayBuffer();
                    const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
                    const pageCount = pdfDoc.getPageCount();

                    document.getElementById('fileNameValue').textContent = file.name;
                    document.getElementById('fileSizeValue').textContent = this.formatFileSize(file.size);
                    document.getElementById('pageCountValue').textContent = pageCount;

                    this.fileInfo.style.display = 'block';
                    this.compressionOptions.style.display = 'block';
                    this.resultArea.style.display = 'none';
                    this.hideMessage();
                } catch (error) {
                    this.showMessage(languages[currentLanguage].errorProcessing, 'error');
                }
            }

            async compressPDF() {
                if (!this.currentFile) return;

                this.compressBtn.disabled = true;
                this.progressContainer.style.display = 'block';
                this.resultArea.style.display = 'none';
                this.hideMessage();

                try {
                    const compressionLevel = document.getElementById('compressionLevel').value;
                    this.updateProgress(10, languages[currentLanguage].processing);

                    const arrayBuffer = await this.currentFile.arrayBuffer();
                    this.updateProgress(20, languages[currentLanguage].processing);

                    // PDF.jsë¥¼ ì´ìš©í•´ PDF ë¶„ì„
                    const loadingTask = pdfjsLib.getDocument({data: arrayBuffer});
                    const pdf = await loadingTask.promise;
                    this.updateProgress(30, languages[currentLanguage].processing);

                    // ìµœì í™” ì˜µì…˜
                    const removeMetadata = document.getElementById('removeMetadata').checked;
                    const optimizeImages = document.getElementById('optimizeImages').checked;

                    if (compressionLevel === 'smart') {
                        // ìŠ¤ë§ˆíŠ¸ ì••ì¶• ëª¨ë“œ
                        const targetSizeKB = this.getTargetSizeKB();
                        const compressedBytes = await this.smartCompress(pdf, targetSizeKB, removeMetadata, optimizeImages);
                        this.showCompressionResult(this.currentFile.size, compressedBytes.length, compressedBytes);
                    } else {
                        // ê¸°ë³¸ ì••ì¶• ëª¨ë“œ
                        const compressedBytes = await this.standardCompress(pdf, compressionLevel, removeMetadata, optimizeImages);
                        this.showCompressionResult(this.currentFile.size, compressedBytes.length, compressedBytes);
                    }

                } catch (error) {
                    console.error('Compression error:', error);
                    this.showMessage(languages[currentLanguage].errorProcessing, 'error');
                } finally {
                    this.compressBtn.disabled = false;
                    this.progressContainer.style.display = 'none';
                }
            }

            getTargetSizeKB() {
                const preset = document.getElementById('targetSizePreset').value;
                const custom = parseFloat(document.getElementById('customTargetSize').value);
                
                if (preset) {
                    return parseInt(preset);
                } else if (custom && custom > 0) {
                    return Math.round(custom * 1024);
                } else {
                    return 2048; // ê¸°ë³¸ê°’ 2MB
                }
            }

            async smartCompress(pdf, targetSizeKB, removeMetadata, optimizeImages) {
                this.updateProgress(35, 'ğŸ¯ ìŠ¤ë§ˆíŠ¸ ì••ì¶• ë¶„ì„ ì¤‘...');
                
                // ì••ì¶• ë ˆë²¨ í›„ë³´ë“¤ (ë†’ì€ í’ˆì§ˆë¶€í„° ë‚®ì€ í’ˆì§ˆê¹Œì§€)
                const qualityLevels = [
                    { imageQuality: 0.9, jpegQuality: 95, resolutionDpi: 150, name: 'ìµœê³ í’ˆì§ˆ' },
                    { imageQuality: 0.8, jpegQuality: 85, resolutionDpi: 150, name: 'ê³ í’ˆì§ˆ' },
                    { imageQuality: 0.7, jpegQuality: 75, resolutionDpi: 140, name: 'ìš°ìˆ˜' },
                    { imageQuality: 0.6, jpegQuality: 65, resolutionDpi: 130, name: 'ì–‘í˜¸' },
                    { imageQuality: 0.5, jpegQuality: 55, resolutionDpi: 120, name: 'ë³´í†µ' },
                    { imageQuality: 0.4, jpegQuality: 45, resolutionDpi: 110, name: 'ì••ì¶•' },
                    { imageQuality: 0.35, jpegQuality: 40, resolutionDpi: 100, name: 'ê³ ì••ì¶•' },
                    { imageQuality: 0.3, jpegQuality: 35, resolutionDpi: 96, name: 'ë§¤ìš°ì••ì¶•' },
                    { imageQuality: 0.25, jpegQuality: 30, resolutionDpi: 90, name: 'ê·¹í•œì••ì¶•' },
                    { imageQuality: 0.2, jpegQuality: 25, resolutionDpi: 80, name: 'ìµœì†Œí¬ê¸°' }
                ];

                const targetSizeBytes = targetSizeKB * 1024;
                let bestResult = null;

                // ì´ì§„ íƒìƒ‰ìœ¼ë¡œ ìµœì  í’ˆì§ˆ ì°¾ê¸°
                for (let i = 0; i < qualityLevels.length; i++) {
                    const settings = qualityLevels[i];
                    this.updateProgress(40 + (i / qualityLevels.length) * 40, 
                        `ğŸ¯ í’ˆì§ˆ í…ŒìŠ¤íŠ¸ ì¤‘... (${settings.name})`);
                    
                    try {
                        const result = await this.compressWithSettings(pdf, settings, removeMetadata, optimizeImages);
                        
                        console.log(`í’ˆì§ˆ ${settings.name}: ${(result.length / 1024).toFixed(1)}KB (ëª©í‘œ: ${targetSizeKB}KB)`);
                        
                        if (result.length <= targetSizeBytes) {
                            // ëª©í‘œ í¬ê¸° ì´í•˜ ë‹¬ì„±!
                            bestResult = result;
                            this.updateProgress(85, `âœ… ìµœì  í’ˆì§ˆ ë°œê²¬: ${settings.name}`);
                            break;
                        }
                        
                        // ë§ˆì§€ë§‰ ì‹œë„ë¼ë©´ ì´ê²ƒì„ ì‚¬ìš©
                        if (i === qualityLevels.length - 1) {
                            bestResult = result;
                        }
                        
                    } catch (error) {
                        console.warn(`í’ˆì§ˆ ${settings.name} í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:`, error);
                        continue;
                    }
                }

                if (!bestResult) {
                    throw new Error('ì••ì¶• ì‹¤íŒ¨');
                }

                this.updateProgress(100, 'âœ… ìŠ¤ë§ˆíŠ¸ ì••ì¶• ì™„ë£Œ!');
                return bestResult;
            }

            async standardCompress(pdf, compressionLevel, removeMetadata, optimizeImages) {
                // ê¸°ì¡´ ì••ì¶• ë¡œì§
                const compressionSettings = {
                    low: { imageQuality: 0.8, jpegQuality: 90, resolutionDpi: 150 },
                    medium: { imageQuality: 0.6, jpegQuality: 70, resolutionDpi: 120 },
                    high: { imageQuality: 0.4, jpegQuality: 50, resolutionDpi: 96 },
                    extreme: { imageQuality: 0.25, jpegQuality: 30, resolutionDpi: 72 }
                };

                const settings = compressionSettings[compressionLevel];
                this.updateProgress(40, languages[currentLanguage].processing);
                
                return await this.compressWithSettings(pdf, settings, removeMetadata, optimizeImages);
            }

            async compressWithSettings(pdf, settings, removeMetadata, optimizeImages) {
                // PDF-libë¡œ ìƒˆ PDF ë¬¸ì„œ ìƒì„±
                const newPdfDoc = await PDFLib.PDFDocument.create();

                // ê° í˜ì´ì§€ë¥¼ ì²˜ë¦¬
                for (let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const viewport = page.getViewport({ scale: 1.0 });

                    // Canvasë¥¼ ìƒì„±í•˜ì—¬ í˜ì´ì§€ë¥¼ ë Œë”ë§
                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    
                    // DPIì— ë”°ë¥¸ ìŠ¤ì¼€ì¼ ì¡°ì •
                    const scale = settings.resolutionDpi / 72; // 72 DPIê°€ ê¸°ë³¸
                    const scaledViewport = page.getViewport({ scale: scale });
                    
                    canvas.height = scaledViewport.height;
                    canvas.width = scaledViewport.width;

                    const renderContext = {
                        canvasContext: context,
                        viewport: scaledViewport
                    };

                    await page.render(renderContext).promise;

                    // Canvasë¥¼ ì´ë¯¸ì§€ë¡œ ë³€í™˜í•˜ì—¬ ì••ì¶•
                    const imageDataUrl = canvas.toDataURL('image/jpeg', settings.imageQuality);
                    const imageBytes = this.dataUrlToBytes(imageDataUrl);

                    // ìƒˆ PDF ë¬¸ì„œì— ì••ì¶•ëœ ì´ë¯¸ì§€ë¡œ í˜ì´ì§€ ì¶”ê°€
                    const jpgImage = await newPdfDoc.embedJpg(imageBytes);
                    const newPage = newPdfDoc.addPage([viewport.width, viewport.height]);
                    
                    newPage.drawImage(jpgImage, {
                        x: 0,
                        y: 0,
                        width: viewport.width,
                        height: viewport.height,
                    });
                }

                // ë©”íƒ€ë°ì´í„° ì²˜ë¦¬
                if (removeMetadata) {
                    newPdfDoc.setTitle('');
                    newPdfDoc.setAuthor('');
                    newPdfDoc.setSubject('');
                    newPdfDoc.setKeywords([]);
                    newPdfDoc.setProducer('');
                    newPdfDoc.setCreator('');
                } else {
                    newPdfDoc.setProducer('PDF Compress - alllogo.net');
                }

                // ìµœì¢… ì••ì¶•ëœ PDF ì €ì¥
                const saveOptions = {
                    useObjectStreams: true,
                    addDefaultPage: false,
                };

                const compressedBytes = await newPdfDoc.save(saveOptions);
                return compressedBytes;
            }

            dataUrlToBytes(dataUrl) {
                const base64 = dataUrl.split(',')[1];
                const binaryString = atob(base64);
                const bytes = new Uint8Array(binaryString.length);
                for (let i = 0; i < binaryString.length; i++) {
                    bytes[i] = binaryString.charCodeAt(i);
                }
                return bytes;
            }

            showCompressionResult(originalSize, compressedSize, compressedBytes) {
                const compressionRatio = Math.round((1 - compressedSize / originalSize) * 100);
                const savedBytes = originalSize - compressedSize;

                document.getElementById('originalSize').textContent = this.formatFileSize(originalSize);
                document.getElementById('compressedSize').textContent = this.formatFileSize(compressedSize);
                document.getElementById('compressionRatio').textContent = `${Math.max(0, compressionRatio)}%`;

                // ì••ì¶• íš¨ê³¼ë¥¼ ë” ëª…í™•í•˜ê²Œ í‘œì‹œ
                const resultCard = document.querySelector('.result-card');
                if (compressionRatio > 0) {
                    resultCard.style.background = 'var(--success-color)';
                    const resultText = document.querySelector('.result-text');
                    resultText.innerHTML = `
                        ${languages[currentLanguage].compressionComplete}<br>
                        <small style="opacity: 0.9;">íŒŒì¼ í¬ê¸°ê°€ ${this.formatFileSize(savedBytes)} ì¤„ì–´ë“¤ì—ˆìŠµë‹ˆë‹¤!</small>
                    `;
                } else {
                    resultCard.style.background = 'var(--warning-color)';
                    const resultText = document.querySelector('.result-text');
                    resultText.innerHTML = `
                        PDF ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.<br>
                        <small style="opacity: 0.9;">ì´ë¯¸ ìµœì í™”ëœ íŒŒì¼ì´ê±°ë‚˜ ì••ì¶•ì´ ì–´ë ¤ìš´ í˜•ì‹ì…ë‹ˆë‹¤.</small>
                    `;
                }

                this.resultArea.style.display = 'block';

                // ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ ì´ë²¤íŠ¸
                this.downloadBtn.onclick = () => {
                    const blob = new Blob([compressedBytes], { type: 'application/pdf' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = this.currentFile.name.replace('.pdf', '_compressed.pdf');
                    a.click();
                    URL.revokeObjectURL(url);
                };
            }

            updateProgress(percent, text) {
                this.progressFill.style.width = `${percent}%`;
                this.progressText.textContent = text;
            }

            showMessage(message, type) {
                this.messageArea.textContent = message;
                this.messageArea.className = `message ${type}`;
                this.messageArea.style.display = 'block';
            }

            hideMessage() {
                this.messageArea.style.display = 'none';
            }

            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
        }

        // PDF ì••ì¶•ê¸° ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            new PDFCompressor();
        });
    </script>

    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3945001668113003" crossorigin="anonymous"></script>
</body>
</html>